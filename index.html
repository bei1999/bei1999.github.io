<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>bei1999 çš„åšå®¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="bei1999 çš„åšå®¢">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="bei1999 çš„åšå®¢">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="bei1999 çš„åšå®¢">
  
    <link rel="alternate" href="/atom.xml" title="bei1999 çš„åšå®¢" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">bei1999 çš„åšå®¢</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Activityå¦‚ä½•è®¡ç®—viewçš„å±‚çº§æ·±åº¦" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/10/29/Activityå¦‚ä½•è®¡ç®—viewçš„å±‚çº§æ·±åº¦/" class="article-date">
  <time datetime="2020-10-29T11:28:08.000Z" itemprop="datePublished">2020-10-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/29/Activityå¦‚ä½•è®¡ç®—viewçš„å±‚çº§æ·±åº¦/">Activityå¦‚ä½•è®¡ç®—viewçš„å±‚çº§æ·±åº¦</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>é€šè¿‡activityéå†å…¶viewå¸ƒå±€çš„å±‚çº§æ·±åº¦</p>
        
          <p class="article-more-link">
            <a href="/2020/10/29/Activityå¦‚ä½•è®¡ç®—viewçš„å±‚çº§æ·±åº¦/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/10/29/Activityå¦‚ä½•è®¡ç®—viewçš„å±‚çº§æ·±åº¦/" data-id="ckgur4yi100014z3koajl2lq6" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Activity-View/">Activity View</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-æœç´¢é¡¹ç›®apkæ–‡ä»¶" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/10/28/æœç´¢é¡¹ç›®apkæ–‡ä»¶/" class="article-date">
  <time datetime="2020-10-28T14:05:02.000Z" itemprop="datePublished">2020-10-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/28/æœç´¢é¡¹ç›®apkæ–‡ä»¶/">æœç´¢é¡¹ç›®apkæ–‡ä»¶</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>åˆ©ç”¨å¹¿åº¦ä¼˜å…ˆæœç´¢å®ç°å¯¹Android å·¥ç¨‹ä¸‹apkæ–‡ä»¶è¿›è¡Œæœç´¢<br>
        
          <p class="article-more-link">
            <a href="/2020/10/28/æœç´¢é¡¹ç›®apkæ–‡ä»¶/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/10/28/æœç´¢é¡¹ç›®apkæ–‡ä»¶/" data-id="ckgur4yky00364z3kvfy3c05h" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Ijkplayer-androidç«¯æ‰§è¡Œæµç¨‹åˆ†æ" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/14/Ijkplayer-androidç«¯æ‰§è¡Œæµç¨‹åˆ†æ/" class="article-date">
  <time datetime="2018-01-14T13:16:34.000Z" itemprop="datePublished">2018-01-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/media/">media</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/14/Ijkplayer-androidç«¯æ‰§è¡Œæµç¨‹åˆ†æ/">Ijkplayer androidç«¯æ‰§è¡Œæµç¨‹åˆ†æ</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘é¡¹ç›®æ¶‰åŠåˆ°ç›´æ’­æµæ’­æ”¾å™¨ï¼Œäºæ˜¯å¯¹bç«™å¼€æºçš„ijkplayerè¿›è¡Œäº†ç¼–è¯‘ï¼Œè¿‡ç¨‹ä¹‹ä¸­å¹¶é˜…è¯»äº†ä¸‹è¿™ä¸ªå¼€å‘æºç ï¼Œåšä¸ªç¬”è®°å§ã€‚</p>
<h2 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h2><p>æŒ‰ç…§github ä¸Šçš„ä»‹ç»é€æ­¥æ‰§è¡Œè„šæœ¬å°±okäº†ï¼Œå¯¼å…¥asæœ€åçš„ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="http://o8ra1yomr.bkt.clouddn.com/å±å¹•å¿«ç…§%202018-01-12%20ä¸‹åˆ5.30.22.png" width="400"></p>
<h2 id="å·¥ç¨‹åˆ†æ"><a href="#å·¥ç¨‹åˆ†æ" class="headerlink" title="å·¥ç¨‹åˆ†æ"></a>å·¥ç¨‹åˆ†æ</h2>
        
          <p class="article-more-link">
            <a href="/2018/01/14/Ijkplayer-androidç«¯æ‰§è¡Œæµç¨‹åˆ†æ/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/01/14/Ijkplayer-androidç«¯æ‰§è¡Œæµç¨‹åˆ†æ/" data-id="ckgur4yjd000v4z3kpuctr49i" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/media/">media</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android-æ’­æ”¾å™¨è°ƒç ”åˆ†æ" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/14/android-æ’­æ”¾å™¨è°ƒç ”åˆ†æ/" class="article-date">
  <time datetime="2018-01-14T13:11:14.000Z" itemprop="datePublished">2018-01-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/media/">media</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/14/android-æ’­æ”¾å™¨è°ƒç ”åˆ†æ/">android æ’­æ”¾å™¨è°ƒç ”åˆ†æ</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>é¡¹ç›®ä¸­æ¶‰åŠåˆ°ç›´æ’­æµï¼Œé¡¹ç›®å¼€å‘ä¹‹åˆç”¨äº†ä¸€æ¬¾è€å¤–ä»˜è´¹æä¾›çš„æ’­æ”¾å™¨jwplayerï¼Œåœ¨å®é™…çš„ä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç°äº†ä¸€äº›é—®é¢˜ï¼Œè¿™çœŸæ˜¯ä¸€æ®µä¸å ªå›é¦–çš„å¾€äº‹ğŸ™ˆï¼Œå½“ç„¶æˆ‘ä¸‹é¢ä¼šè¯´æ˜è¿™ç‚¹ã€‚</p>
<h2 id="å…³äºjwplayer"><a href="#å…³äºjwplayer" class="headerlink" title="å…³äºjwplayer"></a>å…³äºjwplayer</h2><p>æ—¢ç„¶æˆ‘èŠ±é’±äº†ï¼Œä¸ºä»€ä¹ˆè¿˜æ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜å‘¢ï¼Ÿï¼Ÿï¼Ÿ<br>é¦–å…ˆï¼Œjwplayer ä¸»æ¨ç½‘é¡µç«¯æ’­æ”¾å™¨ï¼Œå®¢æˆ·ç«¯å…¶å®å°±æ˜¯å¯¹ç½‘é¡µæ’­æ”¾å™¨çš„ä¸€å±‚åŒ…è£…ï¼Œå¸¸è§„çš„ä¸€äº›æ’­æ”¾ç­‰çš„æ“ä½œå…¶å®æ´—æ´—ç¢ç£¨è¿˜æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œç„¶è€Œæˆ‘ä»¬æœ‰éå¸¸å¼ºå¤§çš„äº§å“åŒå­¦å¸Œæœ›å¯¹æ’­æ”¾å™¨çš„çš®è‚¤æ–‡å­—æŒ‰é’®ç­‰æ·±åº¦å®šåˆ¶ï¼Œç»è¿‡å„ç§é‚®ä»¶å’Œåˆ†æï¼Œæœ‰äº›å·²ç»è§£å†³ï¼Œæœ‰äº›æˆäº†å†å²é—®é¢˜ã€‚<br>æœ‰æ²¡æœ‰å¯èƒ½æˆ‘ä»¬é‡æ–°èŠ±é’±å»æ‰¾ä¸€å®¶å…¬å¸ï¼Ÿæ›¿æˆ‘ä»¬å®Œæˆæ‰€æœ‰çš„å¼€å‘å·¥ä½œï¼Œå¹¶ä¸”æ‰«æ¸…æ‰€æœ‰bugå‘¢ï¼Ÿ</p>
<p>ä¸ç”¨ç€æ€¥å›ç­”ä¸Šé¢çš„ç–‘é—®ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸‹ä¸€äº›åŸºç¡€çŸ¥è¯†</p>
<h2 id="CPU-æ¶æ„"><a href="#CPU-æ¶æ„" class="headerlink" title="CPU æ¶æ„"></a>CPU æ¶æ„</h2><p>CPUæ¶æ„æ˜¯CPUå‚å•†ç»™å±äºåŒä¸€ç³»åˆ—çš„CPUäº§å“å®šçš„ä¸€ä¸ªè§„èŒƒï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†åŒºåˆ†ä¸åŒç±»å‹CPUçš„é‡è¦æ ‡ç¤ºã€‚ç›®å‰å¸‚é¢ä¸Šçš„CPUåˆ†ç±»ä¸»è¦åˆ†æœ‰ä¸¤å¤§é˜µè¥ï¼Œä¸€ä¸ªæ˜¯intelã€AMDä¸ºé¦–çš„å¤æ‚æŒ‡ä»¤é›†CPUï¼Œå¦ä¸€ä¸ªæ˜¯ä»¥IBMã€ARMä¸ºé¦–çš„ç²¾ç®€æŒ‡ä»¤é›†CPUã€‚ä¸¤ä¸ªä¸åŒå“ç‰Œçš„CPUï¼Œå…¶äº§å“çš„æ¶æ„ä¹Ÿä¸ç›¸åŒï¼Œä¾‹å¦‚ï¼ŒIntelã€AMDçš„CPUæ˜¯X86æ¶æ„çš„ï¼Œè€ŒIBMå…¬å¸çš„CPUæ˜¯PowerPCæ¶æ„ï¼ŒARMå…¬å¸æ˜¯ARMæ¶æ„ã€‚</p>
<p>ä¸Šé¢è¯´äº†pcç«¯çš„cpuæ¶æ„æƒ…å†µï¼ŒAndroid ç³»ç»Ÿç›®å‰æ”¯æŒ ARMv5ã€ARMv7ã€ARMv8ã€ x86 ã€x86_64ã€MIPS ä»¥åŠ MIPS64 å…±ä¸ƒç§ CPU æ¶æ„ï¼Œä¹Ÿå°±æ˜¯è¯´é™¤æ­¤ä¹‹å¤–å…¶ä»– CPU æ¶æ„çš„ç¡¬ä»¶å¹¶ä¸èƒ½è¿è¡Œ Android ç³»ç»Ÿã€‚</p>
<h2 id="äº¤å‰ç¼–è¯‘"><a href="#äº¤å‰ç¼–è¯‘" class="headerlink" title="äº¤å‰ç¼–è¯‘"></a>äº¤å‰ç¼–è¯‘</h2><p>åœ¨æŸä¸ªå¹³å°ä¸Šï¼Œç¼–è¯‘å¦ä¸€ç§å¹³å°çš„å¯æ‰§è¡Œç¨‹åºï¼Œå°±æ˜¯äº¤å‰ç¼–è¯‘ï¼Œæ¯”å¦‚åœ¨ x86 å¹³å°ä¸Šï¼Œç¼–è¯‘ arm å¹³å°çš„å¯æ‰§è¡Œç¨‹åºï¼Œè¿™ä¹Ÿæ˜¯ Android ç«¯ä½¿ç”¨æœ€å¤šçš„äº¤å‰ç¼–è¯‘ç±»å‹ã€‚</p>
<p>åœ¨äº¤å‰ç¼–è¯‘æ—¶ï¼Œç”±äºä¸»æœºä¸ç›®æ ‡çš„ä½“ç³»æ¶æ„ã€ç¯å¢ƒä¸åŒï¼Œæ‰€ä»¥äº¤å‰ç¼–è¯‘æ¯”æœ¬åœ°ç¼–è¯‘å¤æ‚å¾ˆå¤šï¼Œéœ€è¦ä¸€äº›å·¥å…·æ¥è§£å†³ä¸»æœºä¸ç›®æ ‡ä¸åŒç‰¹æ€§çš„é—®é¢˜ï¼Œè¿™äº›å·¥å…·æ„æˆçš„å·¥å…·é›†å°±å«åšäº¤å‰ç¼–è¯‘é“¾ã€‚</p>
<h2 id="NDK"><a href="#NDK" class="headerlink" title="NDK"></a>NDK</h2><p>Android NDK æ˜¯åœ¨SDKå‰é¢åˆåŠ ä¸Šäº†â€œåŸç”Ÿâ€äºŒå­—ï¼Œå³Native Development Kitï¼Œå› æ­¤åˆè¢«Googleç§°ä¸ºâ€œNDKâ€</p>
<h2 id="JNI"><a href="#JNI" class="headerlink" title="JNI"></a>JNI</h2><p>JNIæ˜¯Java Native Interfaceçš„ç¼©å†™ï¼Œå®ƒæä¾›äº†è‹¥å¹²çš„APIå®ç°äº†Javaå’Œå…¶ä»–è¯­è¨€çš„é€šä¿¡ï¼ˆä¸»è¦æ˜¯C&amp;C++ï¼‰</p>
<h2 id="FFmpeg-ç®€ä»‹"><a href="#FFmpeg-ç®€ä»‹" class="headerlink" title="FFmpeg ç®€ä»‹"></a>FFmpeg ç®€ä»‹</h2><p> FFmpegæ˜¯ä¸€å¥—å¯ä»¥ç”¨æ¥è®°å½•ã€è½¬æ¢æ•°å­—éŸ³é¢‘ã€è§†é¢‘ï¼Œå¹¶èƒ½å°†å…¶è½¬åŒ–ä¸ºæµçš„å¼€æºè®¡ç®—æœºç¨‹åºã€‚å®ƒåŒ…æ‹¬äº†é¢†å…ˆçš„éŸ³/è§†é¢‘ç¼–ç åº“libavcodecç­‰ã€‚</p>
<ul>
<li>libavformatï¼šç”¨äºå„ç§éŸ³è§†é¢‘å°è£…æ ¼å¼çš„ç”Ÿæˆå’Œè§£æï¼ŒåŒ…æ‹¬è·å–è§£ç æ‰€éœ€ä¿¡æ¯ä»¥ç”Ÿæˆè§£ç ä¸Šä¸‹æ–‡ç»“æ„å’Œè¯»å–éŸ³è§†é¢‘å¸§ç­‰åŠŸèƒ½ï¼›</li>
<li>libavcodecï¼šç”¨äºå„ç§ç±»å‹å£°éŸ³/å›¾åƒç¼–è§£ç ï¼›</li>
<li>libavutilï¼šåŒ…å«ä¸€äº›å…¬å…±çš„å·¥å…·å‡½æ•°ï¼›</li>
<li>libswscaleï¼šç”¨äºè§†é¢‘åœºæ™¯æ¯”ä¾‹ç¼©æ”¾ã€è‰²å½©æ˜ å°„è½¬æ¢ï¼›</li>
<li>libpostprocï¼šç”¨äºåæœŸæ•ˆæœå¤„ç†ï¼›</li>
<li>ffmpegï¼šè¯¥é¡¹ç›®æä¾›çš„ä¸€ä¸ªå·¥å…·ï¼Œå¯ç”¨äºæ ¼å¼è½¬æ¢ã€è§£ç æˆ–ç”µè§†å¡å³æ—¶ç¼–ç ç­‰ï¼›</li>
<li>ffseverï¼šä¸€ä¸ª HTTP å¤šåª’ä½“å³æ—¶å¹¿æ’­ä¸²æµæœåŠ¡å™¨ï¼›</li>
<li>ffplayï¼šæ˜¯ä¸€ä¸ªç®€å•çš„æ’­æ”¾å™¨ï¼Œä½¿ç”¨ffmpeg åº“è§£æå’Œè§£ç ï¼Œé€šè¿‡SDLæ˜¾ç¤ºï¼›</li>
</ul>
<p>ffmpegæ˜¯ä¸€ä¸ªå›½å¤–è‘—åçš„å¼€æºé¡¹ç›®ï¼Œå½“ç„¶ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šï¼Œä½ å°±ä¼šé£ï¼ğŸ˜„ç”±äºFFmpegæ˜¯åœ¨LGPL/GPLåè®®ä¸‹å‘å¸ƒçš„ï¼ˆå¦‚æœä½¿ç”¨äº†å…¶ä¸­ä¸€äº›ä½¿ç”¨GPLåè®®å‘å¸ƒçš„æ¨¡å—åˆ™å¿…é¡»ä½¿ç”¨GPLåè®®ï¼‰ï¼Œä»»ä½•äººéƒ½å¯ä»¥è‡ªç”±ä½¿ç”¨ï¼Œä½†å¿…é¡»ä¸¥æ ¼éµå®ˆLGPL/GPLåè®®ã€‚æœ‰å¾ˆå¤šæ’­æ”¾è½¯ä»¶éƒ½ä½¿ç”¨äº†FFmpegçš„ä»£ç ï¼Œä½†å®ƒä»¬å¹¶æ²¡æœ‰éµå®ˆLGPL/GPLåè®®ï¼Œæ²¡æœ‰å…¬å¼€ä»»ä½•æºä»£ç ã€‚äºæ˜¯è¢«å®˜æ–¹åŠ å…¥äº†è€»è¾±é»‘åå•ï¼Œæ¯”å¦‚æš´é£å½±éŸ³ã€QQå½±éŸ³ç­‰ã€‚</p>
<h2 id="android-å¹³å°ç¼–è¯‘ffmpeg"><a href="#android-å¹³å°ç¼–è¯‘ffmpeg" class="headerlink" title="android å¹³å°ç¼–è¯‘ffmpeg"></a>android å¹³å°ç¼–è¯‘ffmpeg</h2><p>ä¸Šé¢æåˆ°çš„äº†android æ‰‹æœºå¤šç§cpuæ¶æ„ï¼Œffmpegæ˜¯ä¸€ä¸ªå¤„ç†è§†é¢‘çš„å¤æ‚æ“ä½œå¼€æºé¡¹ç›®ã€‚é‚£ä¹ˆåŸºäºffmpegç¼–è§£ç ï¼Œä»0åˆ°1åšä¸ªæ’­æ”¾å™¨æœ‰éœ€è¦åšå“ªäº›å·¥ä½œï¼Ÿ</p>
<ol>
<li>ç¼–è¯‘ FFmpeg</li>
<li>æ–°å»ºjniç¼–å†™å¯¹åº”çš„C/C++è°ƒç”¨FFmpegç¼–è¯‘ç”Ÿæˆçš„soåº“</li>
<li>ndk build å°†è¯¥ C/C++ æ–‡ä»¶ç¼–è¯‘æˆåŠ¨æ€é“¾æ¥åº“ï¼Œæ ¹æ®éœ€æ±‚ç”ŸæˆæŒ‡å®šcpuæ¶æ„soåº“</li>
<li>android å·¥ç¨‹åŠ è½½soåŠ¨æ€åº“</li>
<li>æ’­æ”¾å™¨çš„æ¡†æ¶ç¼–å†™</li>
<li>æ’­æ”¾å™¨çš„uiæ§åˆ¶ç¼–å†™</li>
<li>äº§å“éœ€æ±‚çš„å¼€å‘ä¿®æ”¹</li>
</ol>
<p>ç®€å•çš„è¯´è¿™ä¸ªå«ffmpeg çš„ä¸œè¥¿èƒ½å¤„ç†è§†é¢‘çš„ç¼–è§£ç ï¼Œè§†é¢‘çš„ä¸€äº›å¤„ç†å·¥ä½œï¼Œä½†æˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€ä¸ªæ’­æ”¾å™¨ï¼Œæ’­æ”¾å™¨ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªä»€ä¹ˆcï¼Œcï¼‹ï¼‹çš„å¼€å‘å·¥å…·ï¼å¦‚æœæˆ‘ä»¬èŠ±è´¹å¤§é‡çš„æ—¶é—´å»ä»åº•å±‚å¼€å§‹å°è£…åˆ°ä½¿ç”¨ï¼Œè¿™æ ·äº§å“ç«¥é‹å·²ç–¯ï¼äºæ˜¯å¼€å§‹è°ƒç ”å¸‚é¢ä¸Šçš„æˆå“ä¸åŠæˆå“æ’­æ”¾å™¨ã€‚</p>
<h2 id="è°ƒç ”"><a href="#è°ƒç ”" class="headerlink" title="è°ƒç ”"></a>è°ƒç ”</h2><ol>
<li>Vitamio</li>
</ol>
<p>Vitamioæ˜¯Androidå¹³å°è§†éŸ³é¢‘æ’­æ”¾ç»„ä»¶ï¼Œæ”¯æŒæ’­æ”¾å‡ ä¹æ ¼å¼çš„è§†é¢‘ä»¥åŠä¸»æµç½‘ç»œè§†é¢‘æµï¼ˆhttp/rtsp/mmsç­‰ï¼‰<br>æ³¨ï¼šVitamio æºè‡ªç¾æ‹ä¸€ä¸ªåšæ’­æ”¾å™¨çš„teamï¼Œç›®å‰å¼€å‘teamè§£æ•£äº†ï¼Œæ— æ³•è”ç³»åˆä½œã€‚</p>
<ol>
<li>VLC </li>
</ol>
<p>VLC åº•å±‚åŸºäºffmpeg ioså¹³å°æ”¯æŒæ¯”è¾ƒå¥½ï¼Œandroid å¹³å°æ”¯æŒæ¯”è¾ƒç®€é™‹ï¼Œç»™å‡ºäº†android ä¸€ä¸ªé›†æˆçš„ä¾‹å­</p>
<ol>
<li>ijkplayer</li>
</ol>
<p>ijkplayeræ˜¯bç«™å¼€æºçš„è¶…çº§å¥½ç”¨çš„è§†é¢‘æ’­æ”¾å™¨å–”ã€‚ijkplayer Androidå’Œioséƒ½å¯ç”¨ï¼Œè¿˜æ”¯æŒå¤šç§è§†é¢‘çš„ç¡¬è§£ç ã€‚åº•å±‚ç¼–è§£ç åŸºäºFFmpeg çš„ffplayå®ç°ï¼Œå›½å†…å„å¤§ç›´æ’­å¹³å°å¾ˆå¤šåŸºäºå®ƒè¿›è¡Œå®šåˆ¶å¼€å‘ã€‚</p>
<ol>
<li>JiaoZiVideoPlayer</li>
</ol>
<p>JiaoZiVideoPlayer å±äºä¸ªäººå¼€å‘è€…é¡¹ç›®ï¼Œä¸­æ–‡åèŠ‚æ“è§†é¢‘æ’­æ”¾å™¨ï¼ŒåŸºäºandroid videoviewå®ç°çš„è§†é¢‘æ’­æ”¾æ¡†æ¶ï¼Œå¯åˆ‡æ¢æ’­æ”¾å™¨å¼•æ“Ijkplayer Exoplayer Vitamioç­‰ã€‚è”ç³»ä¸åˆ°ä½œè€…æœ‰ç‰ˆæƒé—®é¢˜ã€‚</p>
<ol>
<li>GSYVideoPlayer</li>
</ol>
<p>åŸºäºIJKPlayerï¼Œå®ç°äº†å¤šåŠŸèƒ½çš„è§†é¢‘æ’­æ”¾å™¨,å¼€æºé¡¹ç›®æœ‰å‚è€ƒJiaoZiVideoPlayeréƒ¨åˆ†ä»£ç ï¼Œä½†åæ¥åšçš„æ‰©å±•åŠŸèƒ½æ›´ä¸°å¯Œå’Œå¼ºå¤§</p>
<ol>
<li>é˜¿é‡Œäº‘æ’­æ”¾å™¨</li>
</ol>
<p>è”ç³»å®¢æœï¼Œåªåšäº‘æœåŠ¡ï¼Œä»–ä»¬å¾—æ’­æ”¾å™¨ä¸»è¦æ˜¯ä»¥çŸ­è§†é¢‘å½•åˆ¶ï¼Œå‘å¸ƒå’Œç›´æ’­ä½¿ç”¨</p>
<ol>
<li>ç½‘æ˜“äº‘æ’­æ”¾å™¨</li>
</ol>
<p>ä¸»è¦åšäº‘æœåŠ¡ï¼Œå–çš„æ˜¯æµè§ˆï¼Œæ’­æ”¾å™¨åªæ˜¯ä¸€ä¸ªç®€æ˜“ç‰ˆæœ¬</p>
<ol>
<li>çˆ±å¥‡è‰ºæ’­æ”¾å™¨</li>
</ol>
<p>ä¸»è¦åšäº‘æœåŠ¡ï¼Œå–çš„æ˜¯æµè§ˆï¼Œæ’­æ”¾å™¨åªæ˜¯ä¸€ä¸ªç®€æ˜“ç‰ˆæœ¬</p>
<ol>
<li>ä¸ƒç‰›æ’­æ”¾å™¨</li>
</ol>
<p>å°è£…çš„IJKPlayer ä¹Ÿæ˜¯ä¸€ä¸ªç®€æ˜“ç‰ˆæœ¬ éœ€è¦äºŒæ¬¡å¼€å‘ï¼Œæˆæœ¬è¾ƒé«˜</p>
<ol>
<li>è…¾è®¯äº‘æ’­æ”¾å™¨</li>
</ol>
<p>ä¸»è¦åšäº‘æœåŠ¡ï¼Œå–çš„æ˜¯æµè§ˆï¼Œæ’­æ”¾å™¨åªæ˜¯ä¸€ä¸ªç®€æ˜“ç‰ˆæœ¬</p>
<ol>
<li>ç¾æ‹é¡¹ç›®æ’­æ”¾å™¨</li>
</ol>
<p>è‡ªå·±åšäº†æ’­æ”¾å™¨ç›¸å…³é›†æˆï¼Œè¿™å—ä»£ç å±äºå•†ä¸šæœºå¯†ï¼Œæ— æ³•åˆä½œã€‚</p>
<ol>
<li>ç†ŠçŒ«ç›´æ’­é¡¹ç›®æ’­æ”¾å™¨</li>
</ol>
<p>å°è£…çš„IJKPlayerï¼Œctoç­”å¤æ²¡æœ‰è¿™æ–¹é¢çš„åˆä½œä¸šåŠ¡ã€‚</p>
<ol>
<li>å¤–åŒ…åˆä½œteam</li>
</ol>
<p>ç”±äºé¡¹ç›®æœ¬èº«è¯„ä¼°å¹¶ä¸å¤§ï¼Œå¹¶ä¸”éœ€è¦çœŸæ­£åšè¿‡ç›´æ’­ç›¸å…³çš„é¡¹ç›®å›¢é˜Ÿï¼Œ</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¸‚é¢ä¸Šåšç›´æ’­çš„å¹³å°å¦‚æ–—é±¼ï¼Œç†ŠçŒ«ç›´æ’­ï¼Œç¾æ‹ç›´æ’­ç­‰éƒ½æ˜¯å†…éƒ¨teamåŸºäºijkplayer ç»§ç»­çš„äºŒæ¬¡å°è£…å¼€å‘ï¼Œæ¯”è¾ƒå¤§å‹çš„ç™¾åº¦t5æ’­æ”¾å™¨ï¼Œä¸ƒç‰›äº‘æ’­æ”¾å™¨ç­‰å‡ºäºå•†ä¸šåŒ–è€ƒè™‘éœ€è¦é…åˆäº‘æœåŠ¡ä½¿ç”¨ï¼Œä¸èƒ½ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œç›®å‰çš„æ–¹æ¡ˆæš‚å®šå°è¯•GSYVideoPlayerä¸VLCæ’­æ”¾å™¨é€šè¿‡è¿›è¡Œå¼€å‘ï¼Œé¡¹ç›®éƒ¨åˆ†é›†æˆè¿›è¡Œä¸€ä¸ªç°åº¦æµ‹è¯•æ¯”è¾ƒä½¿ç”¨çš„æƒ…å†µï¼Œæ—¶é—´å……è£•è¿˜æ˜¯è¦åŸºäºIJKPlayerè¿›è¡Œè‡ªå·±çš„æ’­æ”¾å™¨å¼€å‘ä¸ç»´æŠ¤ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://baike.baidu.com/item/%E5%A4%84%E7%90%86%E5%99%A8%E6%9E%B6%E6%9E%84/8535061?fr=aladdin" target="_blank" rel="noopener">CPUæ¶æ„</a></p>
<p><a href="http://ffmpeg.org/" target="_blank" rel="noopener">FFmpegå®˜ç½‘</a></p>
<p><a href="http://vitamio.org" target="_blank" rel="noopener">Vitamioå®˜ç½‘</a></p>
<p><a href="https://code.videolan.org/videolan/vlc-android" target="_blank" rel="noopener">VLCçš„android é›†æˆé¡¹ç›®åœ°å€</a></p>
<p><a href="https://github.com/Bilibili/ijkplayer" target="_blank" rel="noopener">ijkplayerçš„githubåœ°å€</a></p>
<p><a href="https://github.com/lipangit/JiaoZiVideoPlayer" target="_blank" rel="noopener">èŠ‚æ“è§†é¢‘æ’­æ”¾å™¨åœ°å€</a></p>
<p><a href="https://github.com/CarGuo/GSYVideoPlayer" target="_blank" rel="noopener">GSYVideoPlayer githubåœ°å€</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/01/14/android-æ’­æ”¾å™¨è°ƒç ”åˆ†æ/" data-id="ckgur4ykg002b4z3k83p54wdr" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/media/">media</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-è‡ªå®šä¹‰viewï¼æ ‡ç­¾" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/30/è‡ªå®šä¹‰viewï¼æ ‡ç­¾/" class="article-date">
  <time datetime="2017-12-30T13:13:31.000Z" itemprop="datePublished">2017-12-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CustomView/">CustomView</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/30/è‡ªå®šä¹‰viewï¼æ ‡ç­¾/">è‡ªå®šä¹‰viewï¼æ ‡ç­¾</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘åœ¨çœ‹viewgroup çš„è‡ªå®šä¹‰viewè¿‡ç¨‹ï¼Œé—²æ¥æ— äº‹ï¼Œå†™ä¸€ä¸ª å¸¸è§çš„é€‰æ‹©æ ‡ç­¾æ§ä»¶ï¼Œå‘ç°è¿™ä¸ªè¿‡ç¨‹é‡åˆ°ä¸€äº›å‘ğŸ˜„</p>
<h2 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h2><ol>
<li>éœ€è¦å®šä¹‰ä¸ªå®¹å™¨ç±»ï¼Œlinerlayout ï¼Œrelativelayout,viewgroup.ç­‰ï¼Œç”±äºå­˜åœ¨æ¢è¡Œé—®é¢˜ï¼Œè¿˜æ˜¯ç”¨viewgroupåš</li>
<li>é‡Œé¢çš„æ¡ç›®æ˜¯åœ†è§’çš„ï¼Œå¹¶ä¸”éšç€æ–‡å­—é•¿åº¦å˜åŒ–ï¼Œéœ€è¦æ‰¾ç¾å·¥ï¼Ÿç®—äº†ï¼Œè‡ªå·±å†™å§ğŸ˜¢</li>
<li>æµ‹é‡çš„æ—¶å€™å®½åº¦æ•´ä½“matchparent ä¸ç”¨è€ƒè™‘äº†ï¼Œé«˜åº¦ï¼Ÿ å½“æ¢è¡Œçš„æ—¶å€™é«˜åº¦å¢åŠ </li>
<li>æ’åˆ—çš„æ—¶å€™è¶…è¿‡å±å¹•å®½åº¦éœ€è¦æ¢è¡Œï¼Ÿå—¯</li>
<li>ç‚¹å‡»å˜ä¸ªé¢œè‰²ï¼Ÿclick ç‚¹å‡»äº‹ä»¶æ”¹å˜èƒŒæ™¯é¢œè‰²ã€‚</li>
</ol>
<h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bei.test.widget;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.util.AttributeSet;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * author : lzb</span></span><br><span class="line"><span class="comment"> * e-mail :</span></span><br><span class="line"><span class="comment"> * time   : 2017/12/28</span></span><br><span class="line"><span class="comment"> * desc   :</span></span><br><span class="line"><span class="comment"> * version: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFlowLayout</span> <span class="keyword">extends</span> <span class="title">ViewGroup</span></span>&#123;</span><br><span class="line">    <span class="comment">// å­Viewçš„æ°´å¹³é—´éš”</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> padding = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyFlowLayout</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context,<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyFlowLayout</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, attrs,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyFlowLayout</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        super.onMeasure(widthMeasureSpec,heightMeasureSpec);</span></span><br><span class="line">        Log.d(<span class="string">"bei"</span>,<span class="string">"onMesure--"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å¾—å®ƒçš„çˆ¶å®¹å™¨ä¸ºå®ƒè®¾ç½®çš„æµ‹é‡æ¨¡å¼å’Œå¤§å°</span></span><br><span class="line">        <span class="keyword">int</span> sizeWidth = MeasureSpec.getSize(widthMeasureSpec);</span><br><span class="line">        <span class="keyword">int</span> modeWidth = MeasureSpec.getMode(widthMeasureSpec);</span><br><span class="line">        <span class="keyword">int</span> sizeHeight = MeasureSpec.getSize(heightMeasureSpec);</span><br><span class="line">        <span class="keyword">int</span> modeHeight = MeasureSpec.getMode(heightMeasureSpec);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”¨äºwarp_contentæƒ…å†µä¸‹ï¼Œæ¥è®°å½•çˆ¶viewå®½å’Œé«˜</span></span><br><span class="line">        <span class="keyword">int</span> width = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> height = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å–æ¯ä¸€è¡Œå®½åº¦çš„æœ€å¤§å€¼</span></span><br><span class="line">        <span class="keyword">int</span> lineWidth = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// æ¯ä¸€è¡Œçš„é«˜åº¦ç´¯åŠ </span></span><br><span class="line">        <span class="keyword">int</span> lineHeight = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å¾—å­viewçš„ä¸ªæ•°</span></span><br><span class="line">        <span class="keyword">int</span> cCount = getChildCount();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; cCount; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            View child = getChildAt(i);</span><br><span class="line">            <span class="comment">// æµ‹é‡å­Viewçš„å®½å’Œé«˜ï¼ˆå­viewåœ¨å¸ƒå±€æ–‡ä»¶ä¸­æ˜¯wrap_contentï¼‰</span></span><br><span class="line">            measureChild(child, widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">            <span class="comment">// å¾—åˆ°LayoutParams</span></span><br><span class="line">            MarginLayoutParams lp = (MarginLayoutParams) child.getLayoutParams();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ ¹æ®æµ‹é‡å®½åº¦åŠ ä¸ŠMarginå€¼ç®—å‡ºå­viewçš„å®é™…å®½åº¦ï¼ˆä¸Šæ–‡ä¸­æœ‰è¯´æ˜ï¼‰</span></span><br><span class="line">            <span class="keyword">int</span> childWidth = child.getMeasuredWidth() + lp.leftMargin + lp.rightMargin;</span><br><span class="line">            <span class="comment">// æ ¹æ®æµ‹é‡é«˜åº¦åŠ ä¸ŠMarginå€¼ç®—å‡ºå­viewçš„å®é™…é«˜åº¦</span></span><br><span class="line">            <span class="keyword">int</span> childHeight = child.getMeasuredHeight() + lp.topMargin+ lp.bottomMargin;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è¿™é‡Œçš„çˆ¶viewæ˜¯æœ‰paddingå€¼çš„ï¼Œå¦‚æœå†æ·»åŠ ä¸€ä¸ªå…ƒç´ å°±è¶…å‡ºæœ€å¤§å®½åº¦å°±æ¢è¡Œ</span></span><br><span class="line">            <span class="keyword">if</span> (lineWidth + childWidth &gt; sizeWidth - getPaddingLeft() - getPaddingRight())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// çˆ¶viewå®½åº¦=ä»¥å‰çˆ¶viewå®½åº¦ã€å½“å‰è¡Œå®½çš„æœ€å¤§å€¼</span></span><br><span class="line">                width = Math.max(width, lineWidth);</span><br><span class="line">                <span class="comment">// æ¢è¡Œäº†ï¼Œå½“å‰è¡Œå®½=ç¬¬ä¸€ä¸ªviewçš„å®½åº¦</span></span><br><span class="line">                lineWidth = childWidth;</span><br><span class="line">                <span class="comment">// çˆ¶viewçš„é«˜åº¦=å„è¡Œé«˜åº¦ä¹‹å’Œ</span></span><br><span class="line">                height += lineHeight;</span><br><span class="line">                <span class="comment">//æ¢è¡Œäº†ï¼Œå½“å‰è¡Œé«˜=ç¬¬ä¸€ä¸ªviewçš„é«˜åº¦</span></span><br><span class="line">                lineHeight = childHeight;</span><br><span class="line">            &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">// å åŠ è¡Œå®½</span></span><br><span class="line">                lineWidth += childWidth;</span><br><span class="line">                <span class="comment">// å¾—åˆ°å½“å‰è¡Œæœ€å¤§çš„é«˜åº¦</span></span><br><span class="line">                lineHeight = Math.max(lineHeight, childHeight);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æœ€åä¸€ä¸ªæ§ä»¶</span></span><br><span class="line">            <span class="keyword">if</span> (i == cCount - <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                width = Math.max(lineWidth, width);</span><br><span class="line">                height += lineHeight;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        setMeasuredDimension(</span><br><span class="line">                modeWidth == MeasureSpec.EXACTLY ? sizeWidth : width + getPaddingLeft() + getPaddingRight(),</span><br><span class="line">                modeHeight == MeasureSpec.EXACTLY ? sizeHeight : height + getPaddingTop()+ getPaddingBottom()</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å­˜å‚¨æ‰€æœ‰çš„View</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;List&lt;View&gt;&gt; mAllViews = <span class="keyword">new</span> ArrayList&lt;List&lt;View&gt;&gt;();</span><br><span class="line">    <span class="comment">//å­˜å‚¨æ¯ä¸€è¡Œçš„é«˜åº¦</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Integer&gt; mLineHeight = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> l, <span class="keyword">int</span> t, <span class="keyword">int</span> r, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"bei"</span>,<span class="string">"onLayout----l,t,r,b"</span>+l+<span class="string">"&amp;"</span>+t+<span class="string">"&amp;"</span>+r+<span class="string">"&amp;"</span>+b);</span><br><span class="line"></span><br><span class="line">        mAllViews.clear();</span><br><span class="line">        mLineHeight.clear();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å½“å‰ViewGroupçš„å®½åº¦</span></span><br><span class="line">        <span class="keyword">int</span> width = getWidth();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> lineWidth = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> lineHeight = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// å­˜å‚¨æ¯ä¸€è¡Œæ‰€æœ‰çš„childView</span></span><br><span class="line">        List&lt;View&gt; lineViews = <span class="keyword">new</span> ArrayList&lt;View&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> cCount = getChildCount();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; cCount; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            View child = getChildAt(i);</span><br><span class="line">            MarginLayoutParams lp = (MarginLayoutParams) child.getLayoutParams();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> childWidth = child.getMeasuredWidth();</span><br><span class="line">            <span class="keyword">int</span> childHeight = child.getMeasuredHeight();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ¢è¡Œï¼Œåœ¨onMeasureä¸­childWidthæ˜¯åŠ ä¸ŠMarginå€¼çš„</span></span><br><span class="line">            <span class="keyword">if</span> (lineWidth + childWidth + lp.leftMargin + lp.rightMargin &gt; width - getPaddingLeft() - getPaddingRight())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// è®°å½•è¡Œé«˜</span></span><br><span class="line">                mLineHeight.add(lineHeight);</span><br><span class="line">                <span class="comment">// è®°å½•å½“å‰è¡Œçš„Views</span></span><br><span class="line">                mAllViews.add(lineViews);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// æ–°è¡Œçš„è¡Œå®½å’Œè¡Œé«˜</span></span><br><span class="line">                lineWidth = <span class="number">0</span>;</span><br><span class="line">                lineHeight = childHeight + lp.topMargin + lp.bottomMargin;</span><br><span class="line">                <span class="comment">// æ–°è¡Œçš„Viewé›†åˆ</span></span><br><span class="line">                lineViews = <span class="keyword">new</span> ArrayList&lt;View&gt;();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//ä¸ç®¡æ¢ä¸æ¢è¡Œéƒ½è¦å¤„ç†å½“å‰å­view</span></span><br><span class="line">            lineWidth += childWidth + lp.leftMargin + lp.rightMargin;</span><br><span class="line">            lineHeight = Math.max(lineHeight, childHeight + lp.topMargin+ lp.bottomMargin);</span><br><span class="line">            lineViews.add(child);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¤„ç†æœ€åä¸€è¡Œ</span></span><br><span class="line">        mLineHeight.add(lineHeight);</span><br><span class="line">        mAllViews.add(lineViews);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®å­Viewçš„ä½ç½®</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> left = getPaddingLeft();</span><br><span class="line">        <span class="keyword">int</span> top = getPaddingTop();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¡Œæ•°</span></span><br><span class="line">        <span class="keyword">int</span> lineNum = mAllViews.size();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lineNum; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// å½“å‰è¡Œçš„æ‰€æœ‰çš„View</span></span><br><span class="line">            lineViews = mAllViews.get(i);</span><br><span class="line">            lineHeight = mLineHeight.get(i);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; lineViews.size(); j++)</span><br><span class="line">            &#123;</span><br><span class="line">                View child = lineViews.get(j);</span><br><span class="line">                <span class="comment">// åˆ¤æ–­childçš„çŠ¶æ€</span></span><br><span class="line">                <span class="keyword">if</span> (child.getVisibility() == View.GONE)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                MarginLayoutParams lp = (MarginLayoutParams) child.getLayoutParams();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">int</span> lc = left + lp.leftMargin;</span><br><span class="line">                <span class="keyword">int</span> tc = top + lp.topMargin;</span><br><span class="line">                <span class="keyword">int</span> rc = lc + child.getMeasuredWidth();</span><br><span class="line">                <span class="keyword">int</span> bc = tc + child.getMeasuredHeight();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// ä¸ºå­Viewè¿›è¡Œå¸ƒå±€</span></span><br><span class="line">                child.layout(lc, tc, rc, bc);</span><br><span class="line"></span><br><span class="line">                left += child.getMeasuredWidth() + lp.leftMargin+ lp.rightMargin;</span><br><span class="line">            &#125;</span><br><span class="line">            left = getPaddingLeft() ;</span><br><span class="line">            top += lineHeight ;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LayoutParams <span class="title">generateLayoutParams</span><span class="params">(AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MarginLayoutParams(getContext(), attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> LayoutParams <span class="title">generateDefaultLayoutParams</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MarginLayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> LayoutParams <span class="title">generateLayoutParams</span><span class="params">(LayoutParams p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MarginLayoutParams(p);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨çš„ç±»<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * author : lzb</span></span><br><span class="line"><span class="comment"> * e-mail :</span></span><br><span class="line"><span class="comment"> * time   : 2017/12/28</span></span><br><span class="line"><span class="comment"> * desc   :</span></span><br><span class="line"><span class="comment"> * version: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlowLayoutActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bind</span>(R.id.flowLayout)</span><br><span class="line">    MyFlowLayout flowLayout;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] data = <span class="keyword">new</span> String[]&#123;<span class="string">"football"</span>, <span class="string">"basketball"</span>, <span class="string">"golf"</span>, <span class="string">"polo"</span>, <span class="string">"American football rugby"</span>, <span class="string">"pingpang"</span>&#125;;</span><br><span class="line"></span><br><span class="line">    TextView flowItemTv;</span><br><span class="line"></span><br><span class="line">    LayoutInflater mInflater;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_flow);</span><br><span class="line">        ButterKnife.bind(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        mInflater = LayoutInflater.from(FlowLayoutActivity.<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        initFlowLayout();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initFlowLayout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; data.length; i++) &#123;</span><br><span class="line">            RelativeLayout itemView = (RelativeLayout) mInflater.inflate(R.layout.flow_item, flowLayout, <span class="keyword">false</span>);</span><br><span class="line">            flowItemTv = (TextView) itemView.findViewById(R.id.flow_item_tv);</span><br><span class="line">            flowItemTv.setText(data[i]);</span><br><span class="line">            flowItemTv.setTag(i);</span><br><span class="line">            flowLayout.addView(itemView);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¯¹åº”å¸ƒå±€æ–‡ä»¶<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">com.bei.test.widget.MyFlowLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:padding</span>=<span class="string">"20dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/flowLayout"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">"#ff0000"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>è¿è¡Œæˆªå±</p>
<p><img src="http://o8ra1yomr.bkt.clouddn.com/å±å¹•å¿«ç…§%202017-12-29%20ä¸‹åˆ5.33.33.png" width="â€œ400â€/"></p>
<h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><ol>
<li>onMeasureæ–¹æ³•ä¸­å¦‚æœä¸å®ç° measureChild()æ–¹æ³•å±å¹•ä¸ä¼šæ˜¾ç¤ºä»»ä½•ä¸œè¥¿</li>
<li>onMeasure æµ‹é‡æ¨¡å¼EXACTLYå¯¹åº”match_parent æˆ–å…·ä½“å€¼ è€ŒAT_MOSTå¯¹åº”wrap_content</li>
<li><p>MarginLayoutParamsçš„è·å¾—éœ€è¦é‡å†™generateLayoutParamsï¼ˆï¼‰æ–¹æ³•ï¼Œä¼ å…¥å…·ä½“çš„MarginLayoutParamsï¼Œå¦åˆ™å‘ä¸‹è½¬å‹ä¸å®‰å…¨è¿è¡ŒæŠ¥è½¬å‹å¼‚å¸¸</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.ClassCastException: android.view.ViewGroup$LayoutParams cannot be cast to android.view.ViewGroup$MarginLayoutParams</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ¢è¡Œçš„å¤„ç†éœ€è¦ä¸€è¡Œä¸€è¡Œå¤„ç†ï¼Œå¦‚æœç»Ÿä¸€å¤„ç†ä¼šå‘ç°è·ç¦»å·¦è¾¹è·å¹¶ä¸æ˜¯æ— é™å˜å¤§ï¼Œæ¢è¡Œåˆè¦ä»å¤´å¼€å§‹ã€‚</p>
</li>
</ol>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¸Šé¢ç®€å•çš„å®ç°äº†ä¸€ä¸ªviewgroup çš„æ§ä»¶ï¼Œåé¢æœ‰æ—¶é—´å†å®Œå–„ä¸‹</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/12/30/è‡ªå®šä¹‰viewï¼æ ‡ç­¾/" data-id="ckgur4yll004g4z3kktpz4ms3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/viewgroup/">viewgroup</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-è§£é‡Šå™¨æ¨¡å¼å®ç°ä¸ç ”ç©¶" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/30/è§£é‡Šå™¨æ¨¡å¼å®ç°ä¸ç ”ç©¶/" class="article-date">
  <time datetime="2017-12-30T13:12:02.000Z" itemprop="datePublished">2017-12-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Design-Pattern/">Design Pattern</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/30/è§£é‡Šå™¨æ¨¡å¼å®ç°ä¸ç ”ç©¶/">è§£é‡Šå™¨æ¨¡å¼å®ç°ä¸ç ”ç©¶</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>å®ƒå®šä¹‰äº†å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´è¿›è¡ŒæŸç§æ“ä½œä¹‹åä¼šå¾—åˆ°ä»€ä¹ˆå€¼ã€‚ä¸€èˆ¬ä¸»è¦åº”ç”¨åœ¨OOPå¼€å‘ä¸­çš„ç¼–è¯‘å™¨çš„å¼€å‘ä¸­ï¼Œæ‰€ä»¥é€‚ç”¨é¢æ¯”è¾ƒçª„ã€‚</p>
<h2 id="åœºæ™¯æ¨¡æ‹Ÿ"><a href="#åœºæ™¯æ¨¡æ‹Ÿ" class="headerlink" title="åœºæ™¯æ¨¡æ‹Ÿ"></a>åœºæ™¯æ¨¡æ‹Ÿ</h2><p>android ç³»ç»Ÿä¸­çš„ AndroidManifestæ–‡ä»¶çš„è§£æè¿‡ç¨‹</p>
<h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>AndroidManifest ä¸­å®šä¹‰äº†application,activity,service ç­‰æ ‡ç­¾ï¼Œåœ¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™ç³»ç»Ÿä¼šè°ƒç”¨æœåŠ¡PackageManagerService(PMS),PMS ä¼šè°ƒç”¨scanPackageLIæ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   *  Scan a package and return the newly parsed package.</span></span><br><span class="line"><span class="comment">   *  Returns null in case of errors and the error code is stored in mLastScanError</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> PackageParser.<span class="function">Package <span class="title">scanPackageLI</span><span class="params">(File scanFile, <span class="keyword">int</span> parseFlags, <span class="keyword">int</span> scanFlags,</span></span></span><br><span class="line"><span class="function"><span class="params">          <span class="keyword">long</span> currentTime, UserHandle user)</span> <span class="keyword">throws</span> PackageManagerException </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (DEBUG_INSTALL) Slog.d(TAG, <span class="string">"Parsing: "</span> + scanFile);</span><br><span class="line">      parseFlags |= mDefParseFlags;</span><br><span class="line">      PackageParser pp = <span class="keyword">new</span> PackageParser();</span><br><span class="line">      pp.setSeparateProcesses(mSeparateProcesses);</span><br><span class="line">      pp.setOnlyCoreApps(mOnlyCore);</span><br><span class="line">      pp.setDisplayMetrics(mMetrics);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> ((scanFlags &amp; SCAN_TRUSTED_OVERLAY) != <span class="number">0</span>) &#123;</span><br><span class="line">          parseFlags |= PackageParser.PARSE_TRUSTED_OVERLAY;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">final</span> PackageParser.Package pkg;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          pkg = pp.parsePackage(scanFile, parseFlags);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (PackageParserException e) &#123;</span><br><span class="line">          <span class="keyword">throw</span> PackageManagerException.from(e);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      PackageSetting ps = <span class="keyword">null</span>;</span><br><span class="line">      PackageSetting updatedPkg;</span><br><span class="line">      <span class="comment">// reader</span></span><br><span class="line">      <span class="keyword">synchronized</span> (mPackages) &#123;</span><br><span class="line">          <span class="comment">// Look to see if we already know about this package.</span></span><br><span class="line">          String oldName = mSettings.mRenamedPackages.get(pkg.packageName);</span><br><span class="line">          <span class="keyword">if</span> (pkg.mOriginalPackages != <span class="keyword">null</span> &amp;&amp; pkg.mOriginalPackages.contains(oldName)) &#123;</span><br><span class="line">              <span class="comment">// This package has been renamed to its original name.  Let's</span></span><br><span class="line">              <span class="comment">// use that.</span></span><br><span class="line">              ps = mSettings.peekPackageLPr(oldName);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// If there was no original package, see one for the real package name.</span></span><br><span class="line">          <span class="keyword">if</span> (ps == <span class="keyword">null</span>) &#123;</span><br><span class="line">              ps = mSettings.peekPackageLPr(pkg.packageName);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// Check to see if this package could be hiding/updating a system</span></span><br><span class="line">          <span class="comment">// package.  Must look for it either under the original or real</span></span><br><span class="line">          <span class="comment">// package name depending on our state.</span></span><br><span class="line">          updatedPkg = mSettings.getDisabledSystemPkgLPr(ps != <span class="keyword">null</span> ? ps.name : pkg.packageName);</span><br><span class="line">          <span class="keyword">if</span> (DEBUG_INSTALL &amp;&amp; updatedPkg != <span class="keyword">null</span>) Slog.d(TAG, <span class="string">"updatedPkg = "</span> + updatedPkg);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">boolean</span> updatedPkgBetter = <span class="keyword">false</span>;</span><br><span class="line">      <span class="comment">// First check if this is a system package that may involve an update</span></span><br><span class="line">      <span class="keyword">if</span> (updatedPkg != <span class="keyword">null</span> &amp;&amp; (parseFlags&amp;PackageParser.PARSE_IS_SYSTEM) != <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="comment">// If new package is not located in "/system/priv-app" (e.g. due to an OTA),</span></span><br><span class="line">          <span class="comment">// it needs to drop FLAG_PRIVILEGED.</span></span><br><span class="line">          <span class="keyword">if</span> (locationIsPrivileged(scanFile)) &#123;</span><br><span class="line">              updatedPkg.pkgPrivateFlags |= ApplicationInfo.PRIVATE_FLAG_PRIVILEGED;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              updatedPkg.pkgPrivateFlags &amp;= ~ApplicationInfo.PRIVATE_FLAG_PRIVILEGED;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (ps != <span class="keyword">null</span> &amp;&amp; !ps.codePath.equals(scanFile)) &#123;</span><br><span class="line">              <span class="comment">// The path has changed from what was last scanned...  check the</span></span><br><span class="line">              <span class="comment">// version of the new path against what we have stored to determine</span></span><br><span class="line">              <span class="comment">// what to do.</span></span><br><span class="line">              <span class="keyword">if</span> (DEBUG_INSTALL) Slog.d(TAG, <span class="string">"Path changing from "</span> + ps.codePath);</span><br><span class="line">              <span class="keyword">if</span> (pkg.mVersionCode &lt;= ps.versionCode) &#123;</span><br><span class="line">                  <span class="comment">// The system package has been updated and the code path does not match</span></span><br><span class="line">                  <span class="comment">// Ignore entry. Skip it.</span></span><br><span class="line">                  <span class="keyword">if</span> (DEBUG_INSTALL) Slog.i(TAG, <span class="string">"Package "</span> + ps.name + <span class="string">" at "</span> + scanFile</span><br><span class="line">                          + <span class="string">" ignored: updated version "</span> + ps.versionCode</span><br><span class="line">                          + <span class="string">" better than this "</span> + pkg.mVersionCode);</span><br><span class="line">                  <span class="keyword">if</span> (!updatedPkg.codePath.equals(scanFile)) &#123;</span><br><span class="line">                      Slog.w(PackageManagerService.TAG, <span class="string">"Code path for hidden system pkg : "</span></span><br><span class="line">                              + ps.name + <span class="string">" changing from "</span> + updatedPkg.codePathString</span><br><span class="line">                              + <span class="string">" to "</span> + scanFile);</span><br><span class="line">                      updatedPkg.codePath = scanFile;</span><br><span class="line">                      updatedPkg.codePathString = scanFile.toString();</span><br><span class="line">                      updatedPkg.resourcePath = scanFile;</span><br><span class="line">                      updatedPkg.resourcePathString = scanFile.toString();</span><br><span class="line">                  &#125;</span><br><span class="line">                  updatedPkg.pkg = pkg;</span><br><span class="line">                  <span class="keyword">throw</span> <span class="keyword">new</span> PackageManagerException(INSTALL_FAILED_DUPLICATE_PACKAGE,</span><br><span class="line">                          <span class="string">"Package "</span> + ps.name + <span class="string">" at "</span> + scanFile</span><br><span class="line">                                  + <span class="string">" ignored: updated version "</span> + ps.versionCode</span><br><span class="line">                                  + <span class="string">" better than this "</span> + pkg.mVersionCode);</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                  <span class="comment">// The current app on the system partition is better than</span></span><br><span class="line">                  <span class="comment">// what we have updated to on the data partition; switch</span></span><br><span class="line">                  <span class="comment">// back to the system partition version.</span></span><br><span class="line">                  <span class="comment">// At this point, its safely assumed that package installation for</span></span><br><span class="line">                  <span class="comment">// apps in system partition will go through. If not there won't be a working</span></span><br><span class="line">                  <span class="comment">// version of the app</span></span><br><span class="line">                  <span class="comment">// writer</span></span><br><span class="line">                  <span class="keyword">synchronized</span> (mPackages) &#123;</span><br><span class="line">                      <span class="comment">// Just remove the loaded entries from package lists.</span></span><br><span class="line">                      mPackages.remove(ps.name);</span><br><span class="line">                  &#125;</span><br><span class="line"></span><br><span class="line">                  logCriticalInfo(Log.WARN, <span class="string">"Package "</span> + ps.name + <span class="string">" at "</span> + scanFile</span><br><span class="line">                          + <span class="string">" reverting from "</span> + ps.codePathString</span><br><span class="line">                          + <span class="string">": new version "</span> + pkg.mVersionCode</span><br><span class="line">                          + <span class="string">" better than installed "</span> + ps.versionCode);</span><br><span class="line"></span><br><span class="line">                  InstallArgs args = createInstallArgsForExisting(packageFlagsToInstallFlags(ps),</span><br><span class="line">                          ps.codePathString, ps.resourcePathString, getAppDexInstructionSets(ps));</span><br><span class="line">                  <span class="keyword">synchronized</span> (mInstallLock) &#123;</span><br><span class="line">                      args.cleanUpResourcesLI();</span><br><span class="line">                  &#125;</span><br><span class="line">                  <span class="keyword">synchronized</span> (mPackages) &#123;</span><br><span class="line">                      mSettings.enableSystemPackageLPw(ps.name);</span><br><span class="line">                  &#125;</span><br><span class="line">                  updatedPkgBetter = <span class="keyword">true</span>;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (updatedPkg != <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="comment">// An updated system app will not have the PARSE_IS_SYSTEM flag set</span></span><br><span class="line">          <span class="comment">// initially</span></span><br><span class="line">          parseFlags |= PackageParser.PARSE_IS_SYSTEM;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// An updated privileged app will not have the PARSE_IS_PRIVILEGED</span></span><br><span class="line">          <span class="comment">// flag set initially</span></span><br><span class="line">          <span class="keyword">if</span> ((updatedPkg.pkgPrivateFlags &amp; ApplicationInfo.PRIVATE_FLAG_PRIVILEGED) != <span class="number">0</span>) &#123;</span><br><span class="line">              parseFlags |= PackageParser.PARSE_IS_PRIVILEGED;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Verify certificates against what was last scanned</span></span><br><span class="line">      collectCertificatesLI(pp, ps, pkg, scanFile, parseFlags);</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">       * A new system app appeared, but we already had a non-system one of the</span></span><br><span class="line"><span class="comment">       * same name installed earlier.</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">boolean</span> shouldHideSystemApp = <span class="keyword">false</span>;</span><br><span class="line">      <span class="keyword">if</span> (updatedPkg == <span class="keyword">null</span> &amp;&amp; ps != <span class="keyword">null</span></span><br><span class="line">              &amp;&amp; (parseFlags &amp; PackageParser.PARSE_IS_SYSTEM_DIR) != <span class="number">0</span> &amp;&amp; !isSystemApp(ps)) &#123;</span><br><span class="line">          <span class="comment">/*</span></span><br><span class="line"><span class="comment">           * Check to make sure the signatures match first. If they don't,</span></span><br><span class="line"><span class="comment">           * wipe the installed application and its data.</span></span><br><span class="line"><span class="comment">           */</span></span><br><span class="line">          <span class="keyword">if</span> (compareSignatures(ps.signatures.mSignatures, pkg.mSignatures)</span><br><span class="line">                  != PackageManager.SIGNATURE_MATCH) &#123;</span><br><span class="line">              logCriticalInfo(Log.WARN, <span class="string">"Package "</span> + ps.name + <span class="string">" appeared on system, but"</span></span><br><span class="line">                      + <span class="string">" signatures don't match existing userdata copy; removing"</span>);</span><br><span class="line">              deletePackageLI(pkg.packageName, <span class="keyword">null</span>, <span class="keyword">true</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="number">0</span>, <span class="keyword">null</span>, <span class="keyword">false</span>);</span><br><span class="line">              ps = <span class="keyword">null</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">/*</span></span><br><span class="line"><span class="comment">               * If the newly-added system app is an older version than the</span></span><br><span class="line"><span class="comment">               * already installed version, hide it. It will be scanned later</span></span><br><span class="line"><span class="comment">               * and re-added like an update.</span></span><br><span class="line"><span class="comment">               */</span></span><br><span class="line">              <span class="keyword">if</span> (pkg.mVersionCode &lt;= ps.versionCode) &#123;</span><br><span class="line">                  shouldHideSystemApp = <span class="keyword">true</span>;</span><br><span class="line">                  logCriticalInfo(Log.INFO, <span class="string">"Package "</span> + ps.name + <span class="string">" appeared at "</span> + scanFile</span><br><span class="line">                          + <span class="string">" but new version "</span> + pkg.mVersionCode + <span class="string">" better than installed "</span></span><br><span class="line">                          + ps.versionCode + <span class="string">"; hiding system"</span>);</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                  <span class="comment">/*</span></span><br><span class="line"><span class="comment">                   * The newly found system app is a newer version that the</span></span><br><span class="line"><span class="comment">                   * one previously installed. Simply remove the</span></span><br><span class="line"><span class="comment">                   * already-installed application and replace it with our own</span></span><br><span class="line"><span class="comment">                   * while keeping the application data.</span></span><br><span class="line"><span class="comment">                   */</span></span><br><span class="line">                  logCriticalInfo(Log.WARN, <span class="string">"Package "</span> + ps.name + <span class="string">" at "</span> + scanFile</span><br><span class="line">                          + <span class="string">" reverting from "</span> + ps.codePathString + <span class="string">": new version "</span></span><br><span class="line">                          + pkg.mVersionCode + <span class="string">" better than installed "</span> + ps.versionCode);</span><br><span class="line">                  InstallArgs args = createInstallArgsForExisting(packageFlagsToInstallFlags(ps),</span><br><span class="line">                          ps.codePathString, ps.resourcePathString, getAppDexInstructionSets(ps));</span><br><span class="line">                  <span class="keyword">synchronized</span> (mInstallLock) &#123;</span><br><span class="line">                      args.cleanUpResourcesLI();</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// The apk is forward locked (not public) if its code and resources</span></span><br><span class="line">      <span class="comment">// are kept in different files. (except for app in either system or</span></span><br><span class="line">      <span class="comment">// vendor path).</span></span><br><span class="line">      <span class="comment">// TODO grab this value from PackageSettings</span></span><br><span class="line">      <span class="keyword">if</span> ((parseFlags &amp; PackageParser.PARSE_IS_SYSTEM_DIR) == <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (ps != <span class="keyword">null</span> &amp;&amp; !ps.codePath.equals(ps.resourcePath)) &#123;</span><br><span class="line">              parseFlags |= PackageParser.PARSE_FORWARD_LOCK;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// <span class="doctag">TODO:</span> extend to support forward-locked splits</span></span><br><span class="line">      String resourcePath = <span class="keyword">null</span>;</span><br><span class="line">      String baseResourcePath = <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">if</span> ((parseFlags &amp; PackageParser.PARSE_FORWARD_LOCK) != <span class="number">0</span> &amp;&amp; !updatedPkgBetter) &#123;</span><br><span class="line">          <span class="keyword">if</span> (ps != <span class="keyword">null</span> &amp;&amp; ps.resourcePathString != <span class="keyword">null</span>) &#123;</span><br><span class="line">              resourcePath = ps.resourcePathString;</span><br><span class="line">              baseResourcePath = ps.resourcePathString;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">// Should not happen at all. Just log an error.</span></span><br><span class="line">              Slog.e(TAG, <span class="string">"Resource path not set for pkg : "</span> + pkg.packageName);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          resourcePath = pkg.codePath;</span><br><span class="line">          baseResourcePath = pkg.baseCodePath;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Set application objects path explicitly.</span></span><br><span class="line">      pkg.applicationInfo.volumeUuid = pkg.volumeUuid;</span><br><span class="line">      pkg.applicationInfo.setCodePath(pkg.codePath);</span><br><span class="line">      pkg.applicationInfo.setBaseCodePath(pkg.baseCodePath);</span><br><span class="line">      pkg.applicationInfo.setSplitCodePaths(pkg.splitCodePaths);</span><br><span class="line">      pkg.applicationInfo.setResourcePath(resourcePath);</span><br><span class="line">      pkg.applicationInfo.setBaseResourcePath(baseResourcePath);</span><br><span class="line">      pkg.applicationInfo.setSplitResourcePaths(pkg.splitCodePaths);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Note that we invoke the following method only if we are about to unpack an application</span></span><br><span class="line">      PackageParser.Package scannedPkg = scanPackageLI(pkg, parseFlags, scanFlags</span><br><span class="line">              | SCAN_UPDATE_SIGNATURE, currentTime, user);</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">       * If the system app should be overridden by a previously installed</span></span><br><span class="line"><span class="comment">       * data, hide the system app now and let the /data/app scan pick it up</span></span><br><span class="line"><span class="comment">       * again.</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">if</span> (shouldHideSystemApp) &#123;</span><br><span class="line">          <span class="keyword">synchronized</span> (mPackages) &#123;</span><br><span class="line">              <span class="comment">/*</span></span><br><span class="line"><span class="comment">               * We have to grant systems permissions before we hide, because</span></span><br><span class="line"><span class="comment">               * grantPermissions will assume the package update is trying to</span></span><br><span class="line"><span class="comment">               * expand its permissions.</span></span><br><span class="line"><span class="comment">               */</span></span><br><span class="line">              grantPermissionsLPw(pkg, <span class="keyword">true</span>, pkg.packageName);</span><br><span class="line">              mSettings.disableSystemPackageLPw(pkg.packageName);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> scannedPkg;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>é€šè¿‡ä¸Šé¢çš„ä»£ç å‘ç°ï¼Œé‡è¦çš„éƒ¨åˆ†æ˜¯ä¸‹é¢è¿™å¥ï¼Œæ¶‰åŠåˆ°äº†PackageParser.parsePackage()å‡½æ•°æ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">           pkg = pp.parsePackage(scanFile, parseFlags);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (PackageParserException e) &#123;</span><br><span class="line">           <span class="keyword">throw</span> PackageManagerException.from(e);</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure></p>
<p>PackageParser.parsePackage() å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Parse the package at the given location. Automatically detects if the</span></span><br><span class="line"><span class="comment">    * package is a monolithic style (single APK file) or cluster style</span></span><br><span class="line"><span class="comment">    * (directory of APKs).</span></span><br><span class="line"><span class="comment">    * &lt;p&gt;</span></span><br><span class="line"><span class="comment">    * This performs sanity checking on cluster style packages, such as</span></span><br><span class="line"><span class="comment">    * requiring identical package name and version codes, a single base APK,</span></span><br><span class="line"><span class="comment">    * and unique split names.</span></span><br><span class="line"><span class="comment">    * &lt;p&gt;</span></span><br><span class="line"><span class="comment">    * Note that this &lt;em&gt;does not&lt;/em&gt; perform signature verification; that</span></span><br><span class="line"><span class="comment">    * must be done separately in &#123;<span class="doctag">@link</span> #collectCertificates(Package, int)&#125;.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@see</span> #parsePackageLite(File, int)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Package <span class="title">parsePackage</span><span class="params">(File packageFile, <span class="keyword">int</span> flags)</span> <span class="keyword">throws</span> PackageParserException </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (packageFile.isDirectory()) &#123;</span><br><span class="line">           <span class="keyword">return</span> parseClusterPackage(packageFile, flags);</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">return</span> parseMonolithicPackage(packageFile, flags);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> Package <span class="title">parseClusterPackage</span><span class="params">(File packageDir, <span class="keyword">int</span> flags)</span> <span class="keyword">throws</span> PackageParserException </span>&#123;</span><br><span class="line">       <span class="keyword">final</span> PackageLite lite = parseClusterPackageLite(packageDir, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (mOnlyCoreApps &amp;&amp; !lite.coreApp) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> PackageParserException(INSTALL_PARSE_FAILED_MANIFEST_MALFORMED,</span><br><span class="line">                   <span class="string">"Not a coreApp: "</span> + packageDir);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">final</span> AssetManager assets = <span class="keyword">new</span> AssetManager();</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="comment">// Load the base and all splits into the AssetManager</span></span><br><span class="line">           <span class="comment">// so that resources can be overriden when parsing the manifests.</span></span><br><span class="line">           loadApkIntoAssetManager(assets, lite.baseCodePath, flags);</span><br><span class="line"></span><br><span class="line">           <span class="keyword">if</span> (!ArrayUtils.isEmpty(lite.splitCodePaths)) &#123;</span><br><span class="line">               <span class="keyword">for</span> (String path : lite.splitCodePaths) &#123;</span><br><span class="line">                   loadApkIntoAssetManager(assets, path, flags);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">final</span> File baseApk = <span class="keyword">new</span> File(lite.baseCodePath);</span><br><span class="line">           <span class="keyword">final</span> Package pkg = parseBaseApk(baseApk, assets, flags);</span><br><span class="line">           <span class="keyword">if</span> (pkg == <span class="keyword">null</span>) &#123;</span><br><span class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> PackageParserException(INSTALL_PARSE_FAILED_NOT_APK,</span><br><span class="line">                       <span class="string">"Failed to parse base APK: "</span> + baseApk);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">if</span> (!ArrayUtils.isEmpty(lite.splitNames)) &#123;</span><br><span class="line">               <span class="keyword">final</span> <span class="keyword">int</span> num = lite.splitNames.length;</span><br><span class="line">               pkg.splitNames = lite.splitNames;</span><br><span class="line">               pkg.splitCodePaths = lite.splitCodePaths;</span><br><span class="line">               pkg.splitRevisionCodes = lite.splitRevisionCodes;</span><br><span class="line">               pkg.splitFlags = <span class="keyword">new</span> <span class="keyword">int</span>[num];</span><br><span class="line">               pkg.splitPrivateFlags = <span class="keyword">new</span> <span class="keyword">int</span>[num];</span><br><span class="line"></span><br><span class="line">               <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; num; i++) &#123;</span><br><span class="line">                   parseSplitApk(pkg, i, assets, flags);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           pkg.codePath = packageDir.getAbsolutePath();</span><br><span class="line">           <span class="keyword">return</span> pkg;</span><br><span class="line">       &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">           IoUtils.closeQuietly(assets);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Parse the given APK file, treating it as as a single monolithic package.</span></span><br><span class="line"><span class="comment">    * &lt;p&gt;</span></span><br><span class="line"><span class="comment">    * Note that this &lt;em&gt;does not&lt;/em&gt; perform signature verification; that</span></span><br><span class="line"><span class="comment">    * must be done separately in &#123;<span class="doctag">@link</span> #collectCertificates(Package, int)&#125;.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@deprecated</span> external callers should move to</span></span><br><span class="line"><span class="comment">    *             &#123;<span class="doctag">@link</span> #parsePackage(File, int)&#125;. Eventually this method will</span></span><br><span class="line"><span class="comment">    *             be marked private.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Deprecated</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Package <span class="title">parseMonolithicPackage</span><span class="params">(File apkFile, <span class="keyword">int</span> flags)</span> <span class="keyword">throws</span> PackageParserException </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (mOnlyCoreApps) &#123;</span><br><span class="line">           <span class="keyword">final</span> PackageLite lite = parseMonolithicPackageLite(apkFile, flags);</span><br><span class="line">           <span class="keyword">if</span> (!lite.coreApp) &#123;</span><br><span class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> PackageParserException(INSTALL_PARSE_FAILED_MANIFEST_MALFORMED,</span><br><span class="line">                       <span class="string">"Not a coreApp: "</span> + apkFile);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">final</span> AssetManager assets = <span class="keyword">new</span> AssetManager();</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="keyword">final</span> Package pkg = parseBaseApk(apkFile, assets, flags);</span><br><span class="line">           pkg.codePath = apkFile.getAbsolutePath();</span><br><span class="line">           <span class="keyword">return</span> pkg;</span><br><span class="line">       &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">           IoUtils.closeQuietly(assets);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢çš„ä¸¤ä¸ªå‡½æ•°ä¸éš¾å‘ç°éƒ½åŒæ—¶è°ƒç”¨äº†ç›¸åŒçš„ä¸€ä¸ªæ–¹æ³•<br> parseBaseApk(baseApk, assets, flags); parseBaseApk  ç»è¿‡è·³è½¬æœ€ç»ˆè°ƒç”¨å¦‚ä¸‹<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">String tagName = parser.getName();</span><br><span class="line">          <span class="keyword">if</span> (tagName.equals(<span class="string">"application"</span>)) &#123;</span><br><span class="line">              <span class="keyword">if</span> (foundApp) &#123;</span><br><span class="line">                  <span class="keyword">if</span> (RIGID_PARSER) &#123;</span><br><span class="line">                      outError[<span class="number">0</span>] = <span class="string">"&lt;manifest&gt; has more than one &lt;application&gt;"</span>;</span><br><span class="line">                      mParseError = PackageManager.INSTALL_PARSE_FAILED_MANIFEST_MALFORMED;</span><br><span class="line">                      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                      Slog.w(TAG, <span class="string">"&lt;manifest&gt; has more than one &lt;application&gt;"</span>);</span><br><span class="line">                      XmlUtils.skipCurrentTag(parser);</span><br><span class="line">                      <span class="keyword">continue</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line">              foundApp = <span class="keyword">true</span>;</span><br><span class="line">              <span class="keyword">if</span> (!parseBaseApplication(pkg, res, parser, attrs, flags, outError)) &#123;</span><br><span class="line">                  <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">              &#125;</span><br></pre></td></tr></table></figure></p>
<p>parseBaseApplication éƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Parse the &#123;<span class="doctag">@code</span> application&#125; XML tree at the current parse location in a</span></span><br><span class="line"><span class="comment"> * &lt;em&gt;base APK&lt;/em&gt; manifest.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * When adding new features, carefully consider if they should also be</span></span><br><span class="line"><span class="comment"> * supported by split APKs.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">parseBaseApplication</span><span class="params">(Package owner, Resources res,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     XmlPullParser parser, AttributeSet attrs, <span class="keyword">int</span> flags, String[] outError)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> XmlPullParserException, IOException </span>&#123;</span><br><span class="line">    </span><br><span class="line"> </span><br><span class="line">    <span class="comment">//çœç•¥éƒ¨åˆ†ä»£ç ....</span></span><br><span class="line">    TypedValue v = sa.peekValue(</span><br><span class="line">            com.android.internal.R.styleable.AndroidManifestApplication_label);</span><br><span class="line">    <span class="keyword">if</span> (v != <span class="keyword">null</span> &amp;&amp; (ai.labelRes=v.resourceId) == <span class="number">0</span>) &#123;</span><br><span class="line">        ai.nonLocalizedLabel = v.coerceToString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ai.icon = sa.getResourceId(</span><br><span class="line">            com.android.internal.R.styleable.AndroidManifestApplication_icon, <span class="number">0</span>);</span><br><span class="line">    ai.logo = sa.getResourceId(</span><br><span class="line">            com.android.internal.R.styleable.AndroidManifestApplication_logo, <span class="number">0</span>);</span><br><span class="line">    ai.banner = sa.getResourceId(</span><br><span class="line">            com.android.internal.R.styleable.AndroidManifestApplication_banner, <span class="number">0</span>);</span><br><span class="line">    ai.theme = sa.getResourceId(</span><br><span class="line">            com.android.internal.R.styleable.AndroidManifestApplication_theme, <span class="number">0</span>);</span><br><span class="line">    ai.descriptionRes = sa.getResourceId(</span><br><span class="line">            com.android.internal.R.styleable.AndroidManifestApplication_description, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((flags&amp;PARSE_IS_SYSTEM) != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (sa.getBoolean(</span><br><span class="line">                com.android.internal.R.styleable.AndroidManifestApplication_persistent,</span><br><span class="line">                <span class="keyword">false</span>)) &#123;</span><br><span class="line">            ai.flags |= ApplicationInfo.FLAG_PERSISTENT;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (sa.getBoolean(</span><br><span class="line">            com.android.internal.R.styleable.AndroidManifestApplication_requiredForAllUsers,</span><br><span class="line">            <span class="keyword">false</span>)) &#123;</span><br><span class="line">        owner.mRequiredForAllUsers = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String restrictedAccountType = sa.getString(com.android.internal.R.styleable</span><br><span class="line">            .AndroidManifestApplication_restrictedAccountType);</span><br><span class="line">    <span class="keyword">if</span> (restrictedAccountType != <span class="keyword">null</span> &amp;&amp; restrictedAccountType.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        owner.mRestrictedAccountType = restrictedAccountType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String requiredAccountType = sa.getString(com.android.internal.R.styleable</span><br><span class="line">            .AndroidManifestApplication_requiredAccountType);</span><br><span class="line">    <span class="keyword">if</span> (requiredAccountType != <span class="keyword">null</span> &amp;&amp; requiredAccountType.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        owner.mRequiredAccountType = requiredAccountType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (sa.getBoolean(</span><br><span class="line">            com.android.internal.R.styleable.AndroidManifestApplication_debuggable,</span><br><span class="line">            <span class="keyword">false</span>)) &#123;</span><br><span class="line">        ai.flags |= ApplicationInfo.FLAG_DEBUGGABLE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (sa.getBoolean(</span><br><span class="line">            com.android.internal.R.styleable.AndroidManifestApplication_vmSafeMode,</span><br><span class="line">            <span class="keyword">false</span>)) &#123;</span><br><span class="line">        ai.flags |= ApplicationInfo.FLAG_VM_SAFE_MODE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> innerDepth = parser.getDepth();</span><br><span class="line">    <span class="keyword">int</span> type;</span><br><span class="line">    <span class="keyword">while</span> ((type = parser.next()) != XmlPullParser.END_DOCUMENT</span><br><span class="line">            &amp;&amp; (type != XmlPullParser.END_TAG || parser.getDepth() &gt; innerDepth)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (type == XmlPullParser.END_TAG || type == XmlPullParser.TEXT) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String tagName = parser.getName();</span><br><span class="line">        <span class="keyword">if</span> (tagName.equals(<span class="string">"activity"</span>)) &#123;</span><br><span class="line">            Activity a = parseActivity(owner, res, parser, attrs, flags, outError, <span class="keyword">false</span>,</span><br><span class="line">                    owner.baseHardwareAccelerated);</span><br><span class="line">            <span class="keyword">if</span> (a == <span class="keyword">null</span>) &#123;</span><br><span class="line">                mParseError = PackageManager.INSTALL_PARSE_FAILED_MANIFEST_MALFORMED;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            owner.activities.add(a);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tagName.equals(<span class="string">"receiver"</span>)) &#123;</span><br><span class="line">            Activity a = parseActivity(owner, res, parser, attrs, flags, outError, <span class="keyword">true</span>, <span class="keyword">false</span>);</span><br><span class="line">            <span class="keyword">if</span> (a == <span class="keyword">null</span>) &#123;</span><br><span class="line">                mParseError = PackageManager.INSTALL_PARSE_FAILED_MANIFEST_MALFORMED;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            owner.receivers.add(a);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tagName.equals(<span class="string">"service"</span>)) &#123;</span><br><span class="line">            Service s = parseService(owner, res, parser, attrs, flags, outError);</span><br><span class="line">            <span class="keyword">if</span> (s == <span class="keyword">null</span>) &#123;</span><br><span class="line">                mParseError = PackageManager.INSTALL_PARSE_FAILED_MANIFEST_MALFORMED;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            owner.services.add(s);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tagName.equals(<span class="string">"provider"</span>)) &#123;</span><br><span class="line">            Provider p = parseProvider(owner, res, parser, attrs, flags, outError);</span><br><span class="line">            <span class="keyword">if</span> (p == <span class="keyword">null</span>) &#123;</span><br><span class="line">                mParseError = PackageManager.INSTALL_PARSE_FAILED_MANIFEST_MALFORMED;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            owner.providers.add(p);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tagName.equals(<span class="string">"activity-alias"</span>)) &#123;</span><br><span class="line">            Activity a = parseActivityAlias(owner, res, parser, attrs, flags, outError);</span><br><span class="line">            <span class="keyword">if</span> (a == <span class="keyword">null</span>) &#123;</span><br><span class="line">                mParseError = PackageManager.INSTALL_PARSE_FAILED_MANIFEST_MALFORMED;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            owner.activities.add(a);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (parser.getName().equals(<span class="string">"meta-data"</span>)) &#123;</span><br><span class="line">            <span class="comment">// note: application meta-data is stored off to the side, so it can</span></span><br><span class="line">            <span class="comment">// remain null in the primary copy (we like to avoid extra copies because</span></span><br><span class="line">            <span class="comment">// it can be large)</span></span><br><span class="line">            <span class="keyword">if</span> ((owner.mAppMetaData = parseMetaData(res, parser, attrs, owner.mAppMetaData,</span><br><span class="line">                    outError)) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                mParseError = PackageManager.INSTALL_PARSE_FAILED_MANIFEST_MALFORMED;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tagName.equals(<span class="string">"library"</span>)) &#123;</span><br><span class="line">            sa = res.obtainAttributes(attrs,</span><br><span class="line">                    com.android.internal.R.styleable.AndroidManifestLibrary);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Note: don't allow this value to be a reference to a resource</span></span><br><span class="line">            <span class="comment">// that may change.</span></span><br><span class="line">            String lname = sa.getNonResourceString(</span><br><span class="line">                    com.android.internal.R.styleable.AndroidManifestLibrary_name);</span><br><span class="line"></span><br><span class="line">            sa.recycle();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (lname != <span class="keyword">null</span>) &#123;</span><br><span class="line">                lname = lname.intern();</span><br><span class="line">                <span class="keyword">if</span> (!ArrayUtils.contains(owner.libraryNames, lname)) &#123;</span><br><span class="line">                    owner.libraryNames = ArrayUtils.add(owner.libraryNames, lname);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            XmlUtils.skipCurrentTag(parser);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tagName.equals(<span class="string">"uses-library"</span>)) &#123;</span><br><span class="line">            sa = res.obtainAttributes(attrs,</span><br><span class="line">                    com.android.internal.R.styleable.AndroidManifestUsesLibrary);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Note: don't allow this value to be a reference to a resource</span></span><br><span class="line">            <span class="comment">// that may change.</span></span><br><span class="line">            String lname = sa.getNonResourceString(</span><br><span class="line">                    com.android.internal.R.styleable.AndroidManifestUsesLibrary_name);</span><br><span class="line">            <span class="keyword">boolean</span> req = sa.getBoolean(</span><br><span class="line">                    com.android.internal.R.styleable.AndroidManifestUsesLibrary_required,</span><br><span class="line">                    <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">            sa.recycle();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (lname != <span class="keyword">null</span>) &#123;</span><br><span class="line">                lname = lname.intern();</span><br><span class="line">                <span class="keyword">if</span> (req) &#123;</span><br><span class="line">                    owner.usesLibraries = ArrayUtils.add(owner.usesLibraries, lname);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    owner.usesOptionalLibraries = ArrayUtils.add(</span><br><span class="line">                            owner.usesOptionalLibraries, lname);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            XmlUtils.skipCurrentTag(parser);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (tagName.equals(<span class="string">"uses-package"</span>)) &#123;</span><br><span class="line">            <span class="comment">// Dependencies for app installers; we don't currently try to</span></span><br><span class="line">            <span class="comment">// enforce this.</span></span><br><span class="line">            XmlUtils.skipCurrentTag(parser);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!RIGID_PARSER) &#123;</span><br><span class="line">                Slog.w(TAG, <span class="string">"Unknown element under &lt;application&gt;: "</span> + tagName</span><br><span class="line">                        + <span class="string">" at "</span> + mArchiveSourcePath + <span class="string">" "</span></span><br><span class="line">                        + parser.getPositionDescription());</span><br><span class="line">                XmlUtils.skipCurrentTag(parser);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                outError[<span class="number">0</span>] = <span class="string">"Bad element under &lt;application&gt;: "</span> + tagName;</span><br><span class="line">                mParseError = PackageManager.INSTALL_PARSE_FAILED_MANIFEST_MALFORMED;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modifySharedLibrariesForBackwardCompatibility(owner);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hasDomainURLs(owner)) &#123;</span><br><span class="line">        owner.applicationInfo.privateFlags |= ApplicationInfo.PRIVATE_FLAG_HAS_DOMAIN_URLS;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        owner.applicationInfo.privateFlags &amp;= ~ApplicationInfo.PRIVATE_FLAG_HAS_DOMAIN_URLS;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>ä»ç¨‹åºçœ‹åˆ°ï¼ŒparseApplication å¯¹application èŠ‚ç‚¹çš„å±æ€§è¿›è¡Œäº†è§£æï¼Œè€Œä¸”è¿˜å¯¹è‡ªèŠ‚ç‚¹ç»§ç»­è§£æï¼Œä¸‹é¢æ˜¯å¯¹serviceæ ‡ç­¾çš„è§£æè¿‡ç¨‹ï¼Œactivityç­‰ä¹Ÿéƒ½æœ‰å¯¹åº”çš„è§£æå‡½æ•°<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Service <span class="title">parseService</span><span class="params">(Package owner, Resources res,</span></span></span><br><span class="line"><span class="function"><span class="params">         XmlPullParser parser, AttributeSet attrs, <span class="keyword">int</span> flags, String[] outError)</span></span></span><br><span class="line"><span class="function">         <span class="keyword">throws</span> XmlPullParserException, IOException </span>&#123;</span><br><span class="line">     TypedArray sa = res.obtainAttributes(attrs,</span><br><span class="line">             com.android.internal.R.styleable.AndroidManifestService);</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (mParseServiceArgs == <span class="keyword">null</span>) &#123;</span><br><span class="line">         mParseServiceArgs = <span class="keyword">new</span> ParseComponentArgs(owner, outError,</span><br><span class="line">                 com.android.internal.R.styleable.AndroidManifestService_name,</span><br><span class="line">                 com.android.internal.R.styleable.AndroidManifestService_label,</span><br><span class="line">                 com.android.internal.R.styleable.AndroidManifestService_icon,</span><br><span class="line">                 com.android.internal.R.styleable.AndroidManifestService_logo,</span><br><span class="line">                 com.android.internal.R.styleable.AndroidManifestService_banner,</span><br><span class="line">                 mSeparateProcesses,</span><br><span class="line">                 com.android.internal.R.styleable.AndroidManifestService_process,</span><br><span class="line">                 com.android.internal.R.styleable.AndroidManifestService_description,</span><br><span class="line">                 com.android.internal.R.styleable.AndroidManifestService_enabled);</span><br><span class="line">         mParseServiceArgs.tag = <span class="string">"&lt;service&gt;"</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     </span><br><span class="line">     mParseServiceArgs.sa = sa;</span><br><span class="line">     mParseServiceArgs.flags = flags;</span><br><span class="line">     </span><br><span class="line">     Service s = <span class="keyword">new</span> Service(mParseServiceArgs, <span class="keyword">new</span> ServiceInfo());</span><br><span class="line">     <span class="keyword">if</span> (outError[<span class="number">0</span>] != <span class="keyword">null</span>) &#123;</span><br><span class="line">         sa.recycle();</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">boolean</span> setExported = sa.hasValue(</span><br><span class="line">             com.android.internal.R.styleable.AndroidManifestService_exported);</span><br><span class="line">     <span class="keyword">if</span> (setExported) &#123;</span><br><span class="line">         s.info.exported = sa.getBoolean(</span><br><span class="line">                 com.android.internal.R.styleable.AndroidManifestService_exported, <span class="keyword">false</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     String str = sa.getNonConfigurationString(</span><br><span class="line">             com.android.internal.R.styleable.AndroidManifestService_permission, <span class="number">0</span>);</span><br><span class="line">     <span class="keyword">if</span> (str == <span class="keyword">null</span>) &#123;</span><br><span class="line">         s.info.permission = owner.applicationInfo.permission;</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         s.info.permission = str.length() &gt; <span class="number">0</span> ? str.toString().intern() : <span class="keyword">null</span>;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     s.info.flags = <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">if</span> (sa.getBoolean(</span><br><span class="line">             com.android.internal.R.styleable.AndroidManifestService_stopWithTask,</span><br><span class="line">             <span class="keyword">false</span>)) &#123;</span><br><span class="line">         s.info.flags |= ServiceInfo.FLAG_STOP_WITH_TASK;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">if</span> (sa.getBoolean(</span><br><span class="line">             com.android.internal.R.styleable.AndroidManifestService_isolatedProcess,</span><br><span class="line">             <span class="keyword">false</span>)) &#123;</span><br><span class="line">         s.info.flags |= ServiceInfo.FLAG_ISOLATED_PROCESS;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">if</span> (sa.getBoolean(</span><br><span class="line">             com.android.internal.R.styleable.AndroidManifestService_singleUser,</span><br><span class="line">             <span class="keyword">false</span>)) &#123;</span><br><span class="line">         s.info.flags |= ServiceInfo.FLAG_SINGLE_USER;</span><br><span class="line">         <span class="keyword">if</span> (s.info.exported &amp;&amp; (flags &amp; PARSE_IS_PRIVILEGED) == <span class="number">0</span>) &#123;</span><br><span class="line">             Slog.w(TAG, <span class="string">"Service exported request ignored due to singleUser: "</span></span><br><span class="line">                     + s.className + <span class="string">" at "</span> + mArchiveSourcePath + <span class="string">" "</span></span><br><span class="line">                     + parser.getPositionDescription());</span><br><span class="line">             s.info.exported = <span class="keyword">false</span>;</span><br><span class="line">             setExported = <span class="keyword">true</span>;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     sa.recycle();</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> ((owner.applicationInfo.privateFlags&amp;ApplicationInfo.PRIVATE_FLAG_CANT_SAVE_STATE)</span><br><span class="line">             != <span class="number">0</span>) &#123;</span><br><span class="line">         <span class="comment">// A heavy-weight application can not have services in its main process</span></span><br><span class="line">         <span class="comment">// We can do direct compare because we intern all strings.</span></span><br><span class="line">         <span class="keyword">if</span> (s.info.processName == owner.packageName) &#123;</span><br><span class="line">             outError[<span class="number">0</span>] = <span class="string">"Heavy-weight applications can not have services in main process"</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     </span><br><span class="line">     <span class="keyword">int</span> outerDepth = parser.getDepth();</span><br><span class="line">     <span class="keyword">int</span> type;</span><br><span class="line">     <span class="keyword">while</span> ((type=parser.next()) != XmlPullParser.END_DOCUMENT</span><br><span class="line">            &amp;&amp; (type != XmlPullParser.END_TAG</span><br><span class="line">                    || parser.getDepth() &gt; outerDepth)) &#123;</span><br><span class="line">         <span class="keyword">if</span> (type == XmlPullParser.END_TAG || type == XmlPullParser.TEXT) &#123;</span><br><span class="line">             <span class="keyword">continue</span>;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span> (parser.getName().equals(<span class="string">"intent-filter"</span>)) &#123;</span><br><span class="line">             ServiceIntentInfo intent = <span class="keyword">new</span> ServiceIntentInfo(s);</span><br><span class="line">             <span class="keyword">if</span> (!parseIntent(res, parser, attrs, <span class="keyword">true</span>, <span class="keyword">false</span>, intent, outError)) &#123;</span><br><span class="line">                 <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">             &#125;</span><br><span class="line"></span><br><span class="line">             s.intents.add(intent);</span><br><span class="line">         &#125; <span class="keyword">else</span> <span class="keyword">if</span> (parser.getName().equals(<span class="string">"meta-data"</span>)) &#123;</span><br><span class="line">             <span class="keyword">if</span> ((s.metaData=parseMetaData(res, parser, attrs, s.metaData,</span><br><span class="line">                     outError)) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                 <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">             <span class="keyword">if</span> (!RIGID_PARSER) &#123;</span><br><span class="line">                 Slog.w(TAG, <span class="string">"Unknown element under &lt;service&gt;: "</span></span><br><span class="line">                         + parser.getName() + <span class="string">" at "</span> + mArchiveSourcePath + <span class="string">" "</span></span><br><span class="line">                         + parser.getPositionDescription());</span><br><span class="line">                 XmlUtils.skipCurrentTag(parser);</span><br><span class="line">                 <span class="keyword">continue</span>;</span><br><span class="line">             &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                 outError[<span class="number">0</span>] = <span class="string">"Bad element under &lt;service&gt;: "</span> + parser.getName();</span><br><span class="line">                 <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (!setExported) &#123;</span><br><span class="line">         s.info.exported = s.intents.size() &gt; <span class="number">0</span>;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">return</span> s;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>android ç³»ç»Ÿä¸­çš„PackageManagerService ä»£ç å¾ˆé•¿ï¼Œç¯‡å¹…æœ‰é™ï¼Œåªæ˜¯æ‹¿å¯¹appè§£æéƒ¨åˆ†è¿›è¡Œä¸¾ä¾‹è¯´æ˜è§£é‡Šå™¨æ¨¡å¼çš„å…·ä½“åº”ç”¨<br>ä¼˜ç‚¹ï¼šçµæ´»ï¼Œé€‚åˆæ‰©å±•ï¼Œæ‰©å±•åªéœ€è¦å¢åŠ å¯¹åº”çš„è§£é‡Šå™¨ã€‚<br>ç¼ºç‚¹ï¼šå¾ˆç±»ä¼¼java å¯¹xmlçš„è§£æï¼ŒDOM,SAXç­‰éœ€è¦é€æ¡è§£æï¼Œæ¯ä¸€æ¡æ–‡æ³•è‡³å°‘å¯¹åº”ä¸€ä¸ªè§£é‡Šå™¨ï¼Œæ–‡ä»¶ç±»ä¼šå¢å¤šã€‚è‹¥æ„å»ºçš„æŠ½è±¡è¯­æ³•æ ‘å¤æ‚çš„è¯ï¼Œä¼šå¯¼è‡´ç»´æŠ¤å›°éš¾ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/12/30/è§£é‡Šå™¨æ¨¡å¼å®ç°ä¸ç ”ç©¶/" data-id="ckgur4yls004w4z3klo38inxm" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-è·¨è¿›ç¨‹é€šè®¯ä¹‹AIDLæ€»ç»“å®ç°" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/30/è·¨è¿›ç¨‹é€šè®¯ä¹‹AIDLæ€»ç»“å®ç°/" class="article-date">
  <time datetime="2017-12-30T13:10:20.000Z" itemprop="datePublished">2017-12-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/30/è·¨è¿›ç¨‹é€šè®¯ä¹‹AIDLæ€»ç»“å®ç°/">è·¨è¿›ç¨‹é€šè®¯ä¹‹AIDLæ€»ç»“å®ç°</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Linuxä¸­ä¼ ç»Ÿçš„è·¨è¿›ç¨‹é€šè®¯æ–¹å¼åˆå¾ˆå¤šï¼Œæ¯”å¦‚socketã€ä¿¡å·é‡ã€ç®¡é“ã€å†…å­˜å…±äº«ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼ŒAndroid æ˜¯åŸºäºLinux,Android ç³»ç»Ÿè®¾è®¡äº†ä¸€ä¸ªæ–°çš„é€šè®¯æœºåˆ¶ï¼Œsocketå¼€é”€å¤§ï¼Œç®¡é“å’Œé˜Ÿåˆ—æ‹·è´æ¬¡æ•°å¤šï¼Œè€Œä¸”Binder è€ƒè™‘åˆ°çš„ä¼ è¾“çš„å®‰å…¨æ€§ï¼Œä½†Binder æœºåˆ¶å¾ˆåºå¤§ï¼Œgoogle android äººå‘˜è€ƒè™‘åˆ°äº†è¿™äº›æƒ…å†µï¼Œæä¾›äº†ä¸€ä¸ªç®€ä¾¿çš„è·¨è¿›ç¨‹æ–¹å¼ï¼Œåº”ç”¨å¼€å‘è€…ç¼–å†™Binder Service æä¾›äº†AIDL,å…¨ç¨‹Android Interface Description Language,å³Androidæ¥å£æè¿°è¯­è¨€ï¼Œä¸‹é¢é€šè¿‡ä¸€ä¸ªä¹‹å‰å·¥ä½œä¸­çš„ä¸‹è½½æœåŠ¡ç‹¬ç«‹è¿›ç¨‹ä¾‹å­æ¨¡æ‹Ÿä¸‹è¿™ä¸ªè¿‡ç¨‹ã€‚</p>
<h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>android ç³»ç»Ÿä¸­ Binder è·¨è¿›ç¨‹é€šè®¯æœºåˆ¶ï¼Œä¸‹é¢æ˜¯é€šè¿‡aidlæ–¹å¼å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * author : lzb</span></span><br><span class="line"><span class="comment"> * e-mail : </span></span><br><span class="line"><span class="comment"> * time   : 2017/12/22</span></span><br><span class="line"><span class="comment"> * desc   : download interface</span></span><br><span class="line"><span class="comment"> * version: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IDownload</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">start</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">onPause</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">onStop</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * author : lzb</span></span><br><span class="line"><span class="comment"> * e-mail : </span></span><br><span class="line"><span class="comment"> * time   : 2017/12/22</span></span><br><span class="line"><span class="comment"> * desc   :</span></span><br><span class="line"><span class="comment"> * version: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadBinder</span> <span class="keyword">extends</span> <span class="title">Binder</span> <span class="keyword">implements</span> <span class="title">IDownload</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onPause</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * author : lzb</span></span><br><span class="line"><span class="comment"> * e-mail : </span></span><br><span class="line"><span class="comment"> * time   : 2017/12/22</span></span><br><span class="line"><span class="comment"> * desc   : æ„å»ºä¸‹è½½æœåŠ¡</span></span><br><span class="line"><span class="comment"> * version: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadService</span> <span class="keyword">extends</span> <span class="title">Service</span></span>&#123;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DownloadBinder();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * author : lzb</span></span><br><span class="line"><span class="comment"> * e-mail : </span></span><br><span class="line"><span class="comment"> * time   : 2017/12/22</span></span><br><span class="line"><span class="comment"> * desc   : test</span></span><br><span class="line"><span class="comment"> * version: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadTestActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bind</span>(R.id.startBt)</span><br><span class="line">    Button startBt;</span><br><span class="line">    <span class="meta">@Bind</span>(R.id.pauserBt)</span><br><span class="line">    Button pauserBt;</span><br><span class="line">    <span class="meta">@Bind</span>(R.id.stopBt)</span><br><span class="line">    Button stopBt;</span><br><span class="line">    <span class="meta">@Bind</span>(R.id.stateTv)</span><br><span class="line">    TextView stateTv;</span><br><span class="line">    <span class="keyword">private</span> DownloadBinder downloadBinder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_download);</span><br><span class="line">        ButterKnife.bind(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        ServiceConnection connection = <span class="keyword">new</span> ServiceConnection() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>&#123;</span><br><span class="line">                downloadBinder = (DownloadBinder) service;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(DownloadTestActivity.<span class="keyword">this</span>,DownloadService.class);</span><br><span class="line"></span><br><span class="line">        bindService(intent, connection, BIND_AUTO_CREATE);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnClick</span>(&#123;R.id.startBt, R.id.pauserBt, R.id.stopBt&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onViewClicked</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (view.getId()) &#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.startBt:</span><br><span class="line">                stateTv.setText(<span class="string">"download start :"</span>+downloadBinder.start());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.pauserBt:</span><br><span class="line">                stateTv.setText(<span class="string">"download pause :"</span>+downloadBinder.onPause());</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.stopBt:</span><br><span class="line">                stateTv.setText(<span class="string">"download stop :"</span>+downloadBinder.onStop());</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢çš„ä¸‹è½½æœåŠ¡åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­è¿è¡Œï¼Œè‹¥åˆ†ç¦»æ­¤ä¸‹è½½è¿›è¡Œå¦‚ä¸‹ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">service</span> <span class="attr">android:name</span>=<span class="string">".download.DownloadService"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:process</span>=<span class="string">"com.bei.download"</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>ä¸Šé¢çš„ç¨‹åºä¼šæŠ¥é”™<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">java.lang.ClassCastException: android.os.BinderProxy cannot be cast to com.bei.test.download.DownloadBinder</span><br><span class="line">    at com.bei.test.download.DownloadTestActivity$<span class="number">1</span>.onServiceConnected(DownloadTestActivity.java:<span class="number">48</span>)</span><br><span class="line">    at android.app.LoadedApk$ServiceDispatcher.doConnected(LoadedApk.java:<span class="number">1453</span>)</span><br><span class="line">    at android.app.LoadedApk$ServiceDispatcher$RunConnection.run(LoadedApk.java:<span class="number">1481</span>)</span><br><span class="line">    at android.os.Handler.handleCallback(Handler.java:<span class="number">751</span>)</span><br><span class="line">    at android.os.Handler.dispatchMessage(Handler.java:<span class="number">95</span>)</span><br><span class="line">    at android.os.Looper.loop(Looper.java:<span class="number">154</span>)</span><br><span class="line">    at android.app.ActivityThread.main(ActivityThread.java:<span class="number">6119</span>)</span><br><span class="line">    at java.lang.reflect.Method.invoke(Native Method)</span><br><span class="line">    at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:<span class="number">886</span>)</span><br><span class="line">    at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:<span class="number">776</span>)</span><br></pre></td></tr></table></figure></p>
<p>æç¤ºä¸èƒ½è¿›è¡Œç±»å…³ç³»çš„è½¬åŒ–ï¼Œå› ä¸ºä»–ä»¬ç°åœ¨ä¸åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­äº†ã€‚<br>é¡¹ç›®å³é”®åˆ›å»ºä¸‹è½½å¯¹åº”aidl æ¥å£ï¼Œasä¼šåœ¨main/main/aidl/xxxpackage/*.aidl ç”Ÿæˆå¯¹äºçš„aidlæ–‡ä»¶ï¼Œä¿®æ”¹è¿™ä¸ªæ–‡ä»¶é‡Œé¢çš„æ¥å£æ–¹æ³•å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// IDownloadAIDL.aidl</span></span><br><span class="line"><span class="keyword">package</span> com.bei.test.download;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Declare any non-default types here with import statements</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IDownloadAIDL</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">boolean</span> <span class="title">start</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">     <span class="function"><span class="keyword">boolean</span> <span class="title">onPause</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">     <span class="function"><span class="keyword">boolean</span> <span class="title">onStop</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>DownloadBinder ç±»ä¿®æ”¹ç»§æ‰¿å­ä¸Šé¢çš„aidl æ¥å£<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * author : lzb</span></span><br><span class="line"><span class="comment"> * e-mail : </span></span><br><span class="line"><span class="comment"> * time   : 2017/12/22</span></span><br><span class="line"><span class="comment"> * desc   :</span></span><br><span class="line"><span class="comment"> * version: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadBinder</span> <span class="keyword">extends</span> <span class="title">IDownloadAIDL</span>.<span class="title">Stub</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onPause</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>DownloadService ä¸å˜ï¼Œåªæ˜¯ä¿®æ”¹ç»§æ‰¿å…³ç³»æå®šäº†å¯¹æœåŠ¡ç«¯çš„ä¿®æ”¹ï¼Œå®¢æˆ·ç«¯ä»…æ˜¯serviceconnectionå¯¹è±¡çš„onServiceConnectedæ–¹æ³•ä¸­è·å–Binder çš„æ–¹å¼ä¸åŒï¼Œå³é€šè¿‡aidl è·å–Binder<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>&#123;</span><br><span class="line"><span class="comment">//    downloadBinder = (DownloadBinder) service;</span></span><br><span class="line">      mIDownloadAIDL = IDownloadAIDL.Stub.asInterface(service); <span class="comment">//ä¿®æ”¹æˆé€šè¿‡aidl æ¥å£è·å–binder</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<p>é€šè¿‡aidl çš„Stub.asInterfaceè·å–ä¸€ä¸ªIDownloadAIDLï¼Œé€šè¿‡IDownloadAIDLè°ƒç”¨æœåŠ¡ç«¯çš„DownloadBinderå¯¹åº”çš„å‡½æ•°æ–¹æ³•ï¼Œå®¢æˆ·ç«¯ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * author : lzb</span></span><br><span class="line"><span class="comment"> * e-mail :</span></span><br><span class="line"><span class="comment"> * time   : 2017/12/22</span></span><br><span class="line"><span class="comment"> * desc   : test</span></span><br><span class="line"><span class="comment"> * version: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadTestActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bind</span>(R.id.startBt)</span><br><span class="line">    Button startBt;</span><br><span class="line">    <span class="meta">@Bind</span>(R.id.pauserBt)</span><br><span class="line">    Button pauserBt;</span><br><span class="line">    <span class="meta">@Bind</span>(R.id.stopBt)</span><br><span class="line">    Button stopBt;</span><br><span class="line">    <span class="meta">@Bind</span>(R.id.stateTv)</span><br><span class="line">    TextView stateTv;</span><br><span class="line">    <span class="keyword">private</span> DownloadBinder downloadBinder;</span><br><span class="line">    <span class="keyword">private</span> IDownloadAIDL mIDownloadAIDL;</span><br><span class="line">    <span class="keyword">private</span> ServiceConnection mServiceConnection;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_download);</span><br><span class="line">        ButterKnife.bind(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//downloadBinder = (DownloadBinder) service;</span></span><br><span class="line">        mServiceConnection = <span class="keyword">new</span> ServiceConnection() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>&#123;</span><br><span class="line"><span class="comment">//                downloadBinder = (DownloadBinder) service;</span></span><br><span class="line">                mIDownloadAIDL = IDownloadAIDL.Stub.asInterface(service); <span class="comment">//ä¿®æ”¹æˆé€šè¿‡aidl æ¥å£è·å–binder</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(DownloadTestActivity.<span class="keyword">this</span>,DownloadService.class);</span><br><span class="line"></span><br><span class="line">        bindService(intent, mServiceConnection, BIND_AUTO_CREATE);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnClick</span>(&#123;R.id.startBt, R.id.pauserBt, R.id.stopBt&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onViewClicked</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (view.getId()) &#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.startBt:</span><br><span class="line"><span class="comment">//                stateTv.setText("download start :"+downloadBinder.start());</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    stateTv.setText(<span class="string">"download start :"</span>+mIDownloadAIDL.start());<span class="comment">//aidl è°ƒç”¨startï¼ˆï¼‰</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.pauserBt:</span><br><span class="line"><span class="comment">//                stateTv.setText("download pause :"+downloadBinder.onPause());</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    stateTv.setText(<span class="string">"download pause :"</span>+mIDownloadAIDL.onPause());<span class="comment">//aidl è°ƒç”¨startï¼ˆï¼‰</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.stopBt:</span><br><span class="line"><span class="comment">//                stateTv.setText("download stop :"+downloadBinder.onStop());</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    stateTv.setText(<span class="string">"download stop :"</span>+mIDownloadAIDL.onStop());<span class="comment">//aidl è°ƒç”¨startï¼ˆï¼‰</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        unbindService(mServiceConnection);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼ŒæœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ä»¥åŠæ¥å£çš„å®šä¹‰è¿ç”¨äº†ä»£ç†æ¨¡å¼ï¼Œåˆ©ç”¨android çš„binder å°è£…çš„aidl ï¼Œç”¨æˆ·å¹¶ä¸å…³ç³»åº•å±‚çš„Binder Driver ç­‰çš„å¤æ‚å®ç°ï¼Œè‡ªåŠ¨åŒ–ç”ŸæˆAIDLæ¥å£æ–‡ä»¶ï¼Œç”¨æˆ·ä¿®æ”¹å¯¹åº”çš„éœ€è¦é€šè®¯çš„å‡½æ•°æ–¹æ³•ï¼Œåœ¨service è¿æ¥è·å–binderä¿®æ”¹æˆé€šè¿‡aidl ,è€Œaidl å†å»è°ƒç”¨å…·ä½“çš„binder æ“ä½œï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šç®€åŒ–äº†android çš„è·¨è¿›ç¨‹å®ç°éš¾åº¦ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/12/30/è·¨è¿›ç¨‹é€šè®¯ä¹‹AIDLæ€»ç»“å®ç°/" data-id="ckgur4ylq004r4z3kgzu84gex" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-è¿­ä»£å™¨æ¨¡å¼å®ç°ä¸ç ”ç©¶" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/30/è¿­ä»£å™¨æ¨¡å¼å®ç°ä¸ç ”ç©¶/" class="article-date">
  <time datetime="2017-12-30T13:06:45.000Z" itemprop="datePublished">2017-12-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Design-Pattern/">Design Pattern</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/30/è¿­ä»£å™¨æ¨¡å¼å®ç°ä¸ç ”ç©¶/">è¿­ä»£å™¨æ¨¡å¼å®ç°ä¸ç ”ç©¶</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>æä¾›äº†ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´ ï¼Œè€Œåˆä¸æš´éœ²å…¶å†…éƒ¨çš„è¡¨ç¤ºã€‚</p>
<h2 id="åœºæ™¯æ¨¡æ‹Ÿ"><a href="#åœºæ™¯æ¨¡æ‹Ÿ" class="headerlink" title="åœºæ™¯æ¨¡æ‹Ÿ"></a>åœºæ™¯æ¨¡æ‹Ÿ</h2><p>è¿­ä»£å™¨æ¨¡å¼åˆç§°ä¸ºæ¸¸æ ‡ï¼ˆcursorï¼‰æ¨¡å¼ï¼Œæºè‡ªäºå®¹å™¨ç±»çš„è®¿é—®ï¼Œæ¯”å¦‚java ä¸­çš„list ï¼Œmap æ•°ç»„ç­‰ï¼Œå°†éå†çš„æ–¹æ³•å°è£…åˆ°å®¹å™¨ä¸­ï¼Œæ–¹å¼å®¹å™¨ç±»çš„å†…éƒ¨ç»†èŠ‚æš´éœ²ï¼Œå› æ­¤äº§ç”Ÿäº†è¿­ä»£å™¨æ¨¡å¼</p>
<h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>è¯´åˆ°æ¸¸æ ‡ï¼Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯android ä¸­çš„æ•°æ®åº“ä¸­çš„cursorï¼Œä¸‹é¢æ˜¯é€šè¿‡ContentProvider è°ƒç”¨æ•°æ®åº“æ“ä½œä¾‹å­æ¥çºµè§‚æ•´ä¸ªè¿‡ç¨‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * author : lzb</span></span><br><span class="line"><span class="comment"> * e-mail : </span></span><br><span class="line"><span class="comment"> * time   : 2017/12/20</span></span><br><span class="line"><span class="comment"> * desc   : æ•°æ®åº“ç®¡ç†ç±»</span></span><br><span class="line"><span class="comment"> * version: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DBHelper</span> <span class="keyword">extends</span> <span class="title">SQLiteOpenHelper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DBHelper</span><span class="params">(Context context, String name, SQLiteDatabase.CursorFactory factory, <span class="keyword">int</span> version)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, name, <span class="keyword">null</span>, version);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(SQLiteDatabase db)</span> </span>&#123;</span><br><span class="line">        db.execSQL(<span class="string">"CREATE TABLE table_fav (_id INTEGER PRIMARY KEY AUTOINCREMENT,name TEXT,age TEXT)"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onUpgrade</span><span class="params">(SQLiteDatabase db, <span class="keyword">int</span> oldVersion, <span class="keyword">int</span> newVersion)</span> </span>&#123;</span><br><span class="line">        db.execSQL(<span class="string">"DROP TABLE IF EXISTS table_fav"</span>);</span><br><span class="line">        onCreate(db);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * author : lzb</span></span><br><span class="line"><span class="comment"> * e-mail :</span></span><br><span class="line"><span class="comment"> * time   : 2017/12/20</span></span><br><span class="line"><span class="comment"> * desc   : å¯¹å¤–æä¾›æ•°æ®æ¥å£ç±»</span></span><br><span class="line"><span class="comment"> * version: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataProvider</span> <span class="keyword">extends</span> <span class="title">ContentProvider</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> DBHelper mDBHelper;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DB_NAME = <span class="string">"favor.db"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DB_TABLE = <span class="string">"table_fav"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DB_VERSION = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> SQLiteDatabase db;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mDBHelper = <span class="keyword">new</span> DBHelper(getContext(), DB_NAME, <span class="keyword">null</span>, DB_VERSION);</span><br><span class="line">        db = mDBHelper.getWritableDatabase();</span><br><span class="line">        <span class="keyword">if</span> (db == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cursor <span class="title">query</span><span class="params">(@NonNull Uri uri, @Nullable String[] projection, @Nullable String selection, @Nullable String[] selectionArgs, @Nullable String sortOrder)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        SQLiteDatabase db = mDBHelper.getReadableDatabase();</span></span><br><span class="line">        <span class="keyword">return</span> db.query(DB_TABLE, projection, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getType</span><span class="params">(@NonNull Uri uri)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Uri <span class="title">insert</span><span class="params">(@NonNull Uri uri, @Nullable ContentValues values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> id = db.insert(DB_TABLE,<span class="keyword">null</span>,values);</span><br><span class="line">        <span class="keyword">if</span> (id &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            Uri newUri = ContentUris.withAppendedId(Favor.CONTENT_URI,id);</span><br><span class="line">            getContext().getContentResolver().notifyChange(newUri,<span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">return</span> newUri;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span>  <span class="keyword">new</span> SQLException(<span class="string">"failed to insert row into"</span> +uri);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">delete</span><span class="params">(@NonNull Uri uri, @Nullable String selection, @Nullable String[] selectionArgs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">update</span><span class="params">(@NonNull Uri uri, @Nullable ContentValues values, @Nullable String selection, @Nullable String[] selectionArgs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * author : lzb</span></span><br><span class="line"><span class="comment"> * e-mail :</span></span><br><span class="line"><span class="comment"> * time   : 2017/12/21</span></span><br><span class="line"><span class="comment"> * desc   : å¸¸é‡</span></span><br><span class="line"><span class="comment"> * version: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Favor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String AUTHORITY = <span class="string">"com.bei.test.db.DataProvider"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PATH = <span class="string">"table_fav"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CONTENT_URL_STRING = <span class="string">"content://"</span> +AUTHORITY +<span class="string">"/"</span>+PATH;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Uri CONTENT_URI = Uri.parse(CONTENT_URL_STRING);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY_NAME = <span class="string">"name"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY_AGE = <span class="string">"age"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * author : lzb</span></span><br><span class="line"><span class="comment"> * e-mail : lizhanbei@cgtn.com</span></span><br><span class="line"><span class="comment"> * time   : 2017/12/20</span></span><br><span class="line"><span class="comment"> * desc   : æµ‹è¯•ç±»</span></span><br><span class="line"><span class="comment"> * version: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ContentResolverDemoActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] PROJECTION = <span class="keyword">new</span> String[]&#123;<span class="string">"name"</span>, <span class="string">"age"</span>&#125;;</span><br><span class="line">    <span class="meta">@Bind</span>(R.id.nameTv)</span><br><span class="line">    EditText nameTv;</span><br><span class="line">    <span class="meta">@Bind</span>(R.id.ageTv)</span><br><span class="line">    EditText ageTv;</span><br><span class="line">    <span class="meta">@Bind</span>(R.id.addBtn)</span><br><span class="line">    Button addBtn;</span><br><span class="line">    <span class="meta">@Bind</span>(R.id.queryBtn)</span><br><span class="line">    Button queryBtn;</span><br><span class="line">    <span class="meta">@Bind</span>(R.id.resultTv)</span><br><span class="line">    TextView resultTv;</span><br><span class="line">    <span class="meta">@Bind</span>(R.id.resultUrl)</span><br><span class="line">    TextView resultUrl;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main09);</span><br><span class="line">        ButterKnife.bind(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnClick</span>(&#123;R.id.addBtn, R.id.queryBtn&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onViewClicked</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (view.getId()) &#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.addBtn:</span><br><span class="line">                ContentValues contentValues = <span class="keyword">new</span> ContentValues();</span><br><span class="line">                contentValues.put(Favor.KEY_NAME, nameTv.getText().toString());</span><br><span class="line">                contentValues.put(Favor.KEY_AGE, ageTv.getText().toString());</span><br><span class="line"></span><br><span class="line">                Uri newUrl = <span class="keyword">this</span>.getContentResolver().insert(Favor.CONTENT_URI, contentValues);</span><br><span class="line"></span><br><span class="line">                resultUrl.setText(<span class="string">"æ·»åŠ æˆåŠŸ ï¼ŒURI:"</span> + newUrl);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.queryBtn:</span><br><span class="line">                Cursor cursor = getContentResolver().query(Favor.CONTENT_URI, PROJECTION, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">                String msg = <span class="string">""</span>;</span><br><span class="line">                cursor.moveToFirst();</span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    msg += <span class="string">"name: "</span> + cursor.getString(<span class="number">0</span>);</span><br><span class="line">                    msg += <span class="string">"age: "</span> + cursor.getString(<span class="number">1</span>)+<span class="string">"\n"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">while</span> (cursor.moveToNext());</span><br><span class="line">                cursor.close();</span><br><span class="line"></span><br><span class="line">                resultTv.setText(msg);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨ContentProviderçš„æ—¶å€™ï¼Œä¸è¦å¿˜è®°AndroidManifest.xmlä¸­æ³¨å†Œå£°æ˜<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">provider</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:authorities</span>=<span class="string">"com.bei.test.db.DataProvider"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">".db.DataProvider"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="http://o8ra1yomr.bkt.clouddn.com/å±å¹•å¿«ç…§%202017-12-21%20ä¸‹åˆ2.11.54.png" width="400"></p>
<h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>ä½¿ç”¨äº†SQLiteOpenHelper çš„query æ–¹æ³•æŸ¥è¯¢ï¼Œæœ€ç»ˆè¿”å›ä¸€ä¸ªcursor çš„æ¸¸æ ‡å¯¹è±¡ï¼Œè¿™å…¶å®å°±æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œé€šè¿‡éå†æ¸¸æ ‡çš„ä½ç½®è¿›è¡Œæ•°æ®çš„éå†å’ŒæŸ¥è¯¢ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å®ƒçš„å­˜åœ¨å¼±åŒ–äº†å®¹å™¨ç±»ä¸éå†ç®—æ³•ä¹‹å‰çš„å…³ç³»ï¼Œå¾ˆå¤šè¯­è¨€æ¯”å¦‚java pythonç­‰è‡ªèº«å®ç°äº†è¿­ä»£å™¨åŠŸèƒ½ï¼Œå¯¹äºå¼€å‘è€…è€Œè¨€å¾ˆå°‘è‡ªå·±å»å®ç°è¿­ä»£å™¨ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/12/30/è¿­ä»£å™¨æ¨¡å¼å®ç°ä¸ç ”ç©¶/" data-id="ckgur4yls004z4z3khmjzu858" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-è´£ä»»é“¾æ¨¡å¼å®ç°ä¸ç ”ç©¶" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/30/è´£ä»»é“¾æ¨¡å¼å®ç°ä¸ç ”ç©¶/" class="article-date">
  <time datetime="2017-12-30T13:04:42.000Z" itemprop="datePublished">2017-12-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Design-Pattern/">Design Pattern</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/30/è´£ä»»é“¾æ¨¡å¼å®ç°ä¸ç ”ç©¶/">è´£ä»»é“¾æ¨¡å¼å®ç°ä¸ç ”ç©¶</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>æœ‰å¤šä¸ªå¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡æŒæœ‰ä¸‹ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œå½¢æˆä¸€æ¡é“¾ï¼Œè¯·æ±‚åœ¨è¿™æ¡é“¾ä¸Šä¼ é€’ï¼Œç›´åˆ°æŸä¸€å¯¹è±¡å†³å®šå¤„ç†è¯¥è¯·æ±‚ï¼Œä½†æ˜¯å‘å‡ºè€…å¹¶ä¸æ¸…æ¥šæœ€ç»ˆå“ªä¸ªå¯¹è±¡ä¼šå¤„ç†è¯¥è¯·æ±‚ã€‚</p>
<h2 id="åœºæ™¯æ¨¡æ‹Ÿ"><a href="#åœºæ™¯æ¨¡æ‹Ÿ" class="headerlink" title="åœºæ™¯æ¨¡æ‹Ÿ"></a>åœºæ™¯æ¨¡æ‹Ÿ</h2><p>android ç³»ç»Ÿä¸­æ¯”è¾ƒç±»ä¼¼çš„å®ç°æ˜¯å¯¹äº‹ä»¶çš„åˆ†å‘å¤„ç†ï¼Œå½“ç”¨æˆ·æ¥è§¦å±å¹•æ—¶å€™ï¼Œandroid å°†äº‹ä»¶å¯¹è±¡ä»viewtree çš„é¡¶éƒ¨è‡³ä¸Šè€Œä¸‹çš„åˆ†å‘ä¼ é€’ï¼Œä¸‹é¢ä¸»è¦åˆ†æä¸‹ViewGroup ä¸­æ˜¯å¦‚ä½•æ´¾å‘å­viewçš„ï¼ŒViewGroup ä¸­æ‰§è¡Œäº‹ä»¶æ´¾å‘çš„æ–¹æ³•æ˜¯dispatchTouchEvent æ–¹æ³•ï¼Œæºç å®ç°å¦‚ä¸‹ã€‚</p>
<h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>ViewGroup ä¸­çš„éƒ¨åˆ†æºç å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br></pre></td><td class="code"><pre><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (mInputEventConsistencyVerifier != <span class="keyword">null</span>) &#123;</span><br><span class="line">           mInputEventConsistencyVerifier.onTouchEvent(ev, <span class="number">1</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// If the event targets the accessibility focused view and this is it, start</span></span><br><span class="line">       <span class="comment">// normal event dispatch. Maybe a descendant is what will handle the click.</span></span><br><span class="line">       <span class="keyword">if</span> (ev.isTargetAccessibilityFocus() &amp;&amp; isAccessibilityFocusedViewOrHost()) &#123;</span><br><span class="line">           ev.setTargetAccessibilityFocus(<span class="keyword">false</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">boolean</span> handled = <span class="keyword">false</span>;</span><br><span class="line">       <span class="keyword">if</span> (onFilterTouchEventForSecurity(ev)) &#123;</span><br><span class="line">           <span class="keyword">final</span> <span class="keyword">int</span> action = ev.getAction();</span><br><span class="line">           <span class="keyword">final</span> <span class="keyword">int</span> actionMasked = action &amp; MotionEvent.ACTION_MASK;</span><br><span class="line"></span><br><span class="line">           <span class="comment">// Handle an initial down.å¤„ç†äº†ç‚¹å‡»downçš„äº‹ä»¶</span></span><br><span class="line">           <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">               <span class="comment">// Throw away all previous state when starting a new touch gesture.</span></span><br><span class="line">               <span class="comment">// The framework may have dropped the up or cancel event for the previous gesture</span></span><br><span class="line">               <span class="comment">// due to an app switch, ANR, or some other state change.</span></span><br><span class="line">               cancelAndClearTouchTargets(ev);</span><br><span class="line">               resetTouchState();</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="comment">// Check for interception.</span></span><br><span class="line">           <span class="keyword">final</span> <span class="keyword">boolean</span> intercepted;</span><br><span class="line">           <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN</span><br><span class="line">                   || mFirstTouchTarget != <span class="keyword">null</span>) &#123;</span><br><span class="line">               <span class="keyword">final</span> <span class="keyword">boolean</span> disallowIntercept = (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != <span class="number">0</span>;</span><br><span class="line">               <span class="keyword">if</span> (!disallowIntercept) &#123;</span><br><span class="line">       </span><br><span class="line">                   intercepted = onInterceptTouchEvent(ev);</span><br><span class="line">                   ev.setAction(action); <span class="comment">// restore action in case it was changed</span></span><br><span class="line">               &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                   intercepted = <span class="keyword">false</span>;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="comment">// There are no touch targets and this action is not an initial down</span></span><br><span class="line">               <span class="comment">// so this view group continues to intercept touches.</span></span><br><span class="line">               intercepted = <span class="keyword">true</span>;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="comment">// If intercepted, start normal event dispatch. Also if there is already</span></span><br><span class="line">           <span class="comment">// a view that is handling the gesture, do normal event dispatch.</span></span><br><span class="line">           <span class="keyword">if</span> (intercepted || mFirstTouchTarget != <span class="keyword">null</span>) &#123;</span><br><span class="line">               ev.setTargetAccessibilityFocus(<span class="keyword">false</span>);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="comment">// Check for cancelation.</span></span><br><span class="line">           <span class="keyword">final</span> <span class="keyword">boolean</span> canceled = resetCancelNextUpFlag(<span class="keyword">this</span>)</span><br><span class="line">                   || actionMasked == MotionEvent.ACTION_CANCEL;</span><br><span class="line"></span><br><span class="line">           <span class="comment">// Update list of touch targets for pointer down, if needed.</span></span><br><span class="line">           <span class="keyword">final</span> <span class="keyword">boolean</span> split = (mGroupFlags &amp; FLAG_SPLIT_MOTION_EVENTS) != <span class="number">0</span>;</span><br><span class="line">           TouchTarget newTouchTarget = <span class="keyword">null</span>;</span><br><span class="line">           <span class="keyword">boolean</span> alreadyDispatchedToNewTouchTarget = <span class="keyword">false</span>;</span><br><span class="line">          <span class="comment">// å¦‚æœäº‹ä»¶æ²¡æœ‰è¢«å–æ¶ˆæˆ–æ‹¦æˆª</span></span><br><span class="line">           <span class="keyword">if</span> (!canceled &amp;&amp; !intercepted) &#123;</span><br><span class="line"></span><br><span class="line">               <span class="comment">// If the event is targeting accessiiblity focus we give it to the</span></span><br><span class="line">               <span class="comment">// view that has accessibility focus and if it does not handle it</span></span><br><span class="line">               <span class="comment">// we clear the flag and dispatch the event to all children as usual.</span></span><br><span class="line">               <span class="comment">// We are looking up the accessibility focused host to avoid keeping</span></span><br><span class="line">               <span class="comment">// state since these events are very rare.</span></span><br><span class="line">               View childWithAccessibilityFocus = ev.isTargetAccessibilityFocus()</span><br><span class="line">                       ? findChildWithAccessibilityFocus() : <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">               <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN</span><br><span class="line">                       || (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_DOWN)</span><br><span class="line">                       || actionMasked == MotionEvent.ACTION_HOVER_MOVE) &#123;</span><br><span class="line">                   <span class="keyword">final</span> <span class="keyword">int</span> actionIndex = ev.getActionIndex(); <span class="comment">// always 0 for down</span></span><br><span class="line">                   <span class="keyword">final</span> <span class="keyword">int</span> idBitsToAssign = split ? <span class="number">1</span> &lt;&lt; ev.getPointerId(actionIndex)</span><br><span class="line">                           : TouchTarget.ALL_POINTER_IDS;</span><br><span class="line"></span><br><span class="line">                   <span class="comment">// Clean up earlier touch targets for this pointer id in case they</span></span><br><span class="line">                   <span class="comment">// have become out of sync.</span></span><br><span class="line">                   removePointersFromTouchTargets(idBitsToAssign);</span><br><span class="line"></span><br><span class="line">                   <span class="keyword">final</span> <span class="keyword">int</span> childrenCount = mChildrenCount;</span><br><span class="line">                   <span class="keyword">if</span> (newTouchTarget == <span class="keyword">null</span> &amp;&amp; childrenCount != <span class="number">0</span>) &#123;</span><br><span class="line">                       <span class="keyword">final</span> <span class="keyword">float</span> x = ev.getX(actionIndex);</span><br><span class="line">                       <span class="keyword">final</span> <span class="keyword">float</span> y = ev.getY(actionIndex);</span><br><span class="line">                       <span class="comment">// Find a child that can receive the event.</span></span><br><span class="line">                       <span class="comment">// Scan children from front to back.</span></span><br><span class="line">                       <span class="comment">// è¿™é‡Œè‡ªä¸Šè€Œä¸‹å¯¹å­èŠ‚ç‚¹è¿›è¡Œæ‰«æï¼Œå¯»æ‰¾å¯ä»¥æ¥å—äº‹ä»¶çš„å­view</span></span><br><span class="line">                       <span class="keyword">final</span> ArrayList&lt;View&gt; preorderedList = buildOrderedChildList();</span><br><span class="line">                       <span class="keyword">final</span> <span class="keyword">boolean</span> customOrder = preorderedList == <span class="keyword">null</span></span><br><span class="line">                               &amp;&amp; isChildrenDrawingOrderEnabled();</span><br><span class="line">                       <span class="keyword">final</span> View[] children = mChildren;</span><br><span class="line">                       <span class="keyword">for</span> (<span class="keyword">int</span> i = childrenCount - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">                           <span class="keyword">final</span> <span class="keyword">int</span> childIndex = customOrder</span><br><span class="line">                                   ? getChildDrawingOrder(childrenCount, i) : i;</span><br><span class="line">                           <span class="keyword">final</span> View child = (preorderedList == <span class="keyword">null</span>)</span><br><span class="line">                                   ? children[childIndex] : preorderedList.get(childIndex);</span><br><span class="line"></span><br><span class="line">                           <span class="comment">// If there is a view that has accessibility focus we want it</span></span><br><span class="line">                           <span class="comment">// to get the event first and if not handled we will perform a</span></span><br><span class="line">                           <span class="comment">// normal dispatch. We may do a double iteration but this is</span></span><br><span class="line">                           <span class="comment">// safer given the timeframe.</span></span><br><span class="line">                           <span class="keyword">if</span> (childWithAccessibilityFocus != <span class="keyword">null</span>) &#123;</span><br><span class="line">                               <span class="keyword">if</span> (childWithAccessibilityFocus != child) &#123;</span><br><span class="line">                                   <span class="keyword">continue</span>;</span><br><span class="line">                               &#125;</span><br><span class="line">                               childWithAccessibilityFocus = <span class="keyword">null</span>;</span><br><span class="line">                               i = childrenCount - <span class="number">1</span>;</span><br><span class="line">                           &#125;</span><br><span class="line"></span><br><span class="line">                           <span class="keyword">if</span> (!canViewReceivePointerEvents(child)</span><br><span class="line">                                   || !isTransformedTouchPointInView(x, y, child, <span class="keyword">null</span>)) &#123;</span><br><span class="line">                               ev.setTargetAccessibilityFocus(<span class="keyword">false</span>);</span><br><span class="line">                               <span class="keyword">continue</span>;</span><br><span class="line">                           &#125;</span><br><span class="line"></span><br><span class="line">                           newTouchTarget = getTouchTarget(child);</span><br><span class="line">                           <span class="keyword">if</span> (newTouchTarget != <span class="keyword">null</span>) &#123;</span><br><span class="line">                               <span class="comment">// Child is already receiving touch within its bounds.</span></span><br><span class="line">                               <span class="comment">// Give it the new pointer in addition to the ones it is handling.</span></span><br><span class="line">                               newTouchTarget.pointerIdBits |= idBitsToAssign;</span><br><span class="line">                               <span class="keyword">break</span>;</span><br><span class="line">                           &#125;</span><br><span class="line"></span><br><span class="line">                           resetCancelNextUpFlag(child);</span><br><span class="line">                           <span class="comment">//å¦‚æœå­å…ƒç´ ä»æ—§æ˜¯ä¸€ä¸ªviewGroup,åˆ™é€’å½’é‡å¤æ­¤è¿‡ç¨‹</span></span><br><span class="line">                           <span class="comment">//å¦‚æœå­å…ƒç´ æ˜¯ä¸€ä¸ªviewï¼Œåˆ™è°ƒç”¨å­view çš„dispathTouchEvent,å¹¶æœ€ç»ˆç”±onTouchEvent å¤„ç†</span></span><br><span class="line">                           <span class="keyword">if</span> (dispatchTransformedTouchEvent(ev, <span class="keyword">false</span>, child, idBitsToAssign)) &#123;</span><br><span class="line">                               <span class="comment">// Child wants to receive touch within its bounds.</span></span><br><span class="line">                               mLastTouchDownTime = ev.getDownTime();</span><br><span class="line">                               <span class="keyword">if</span> (preorderedList != <span class="keyword">null</span>) &#123;</span><br><span class="line">                                   <span class="comment">// childIndex points into presorted list, find original index</span></span><br><span class="line">                                   <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; childrenCount; j++) &#123;</span><br><span class="line">                                       <span class="keyword">if</span> (children[childIndex] == mChildren[j]) &#123;</span><br><span class="line">                                           mLastTouchDownIndex = j;</span><br><span class="line">                                           <span class="keyword">break</span>;</span><br><span class="line">                                       &#125;</span><br><span class="line">                                   &#125;</span><br><span class="line">                               &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                   mLastTouchDownIndex = childIndex;</span><br><span class="line">                               &#125;</span><br><span class="line">                               mLastTouchDownX = ev.getX();</span><br><span class="line">                               mLastTouchDownY = ev.getY();</span><br><span class="line">                               newTouchTarget = addTouchTarget(child, idBitsToAssign);</span><br><span class="line">                               alreadyDispatchedToNewTouchTarget = <span class="keyword">true</span>;</span><br><span class="line">                               <span class="keyword">break</span>;</span><br><span class="line">                           &#125;</span><br><span class="line"></span><br><span class="line">                           <span class="comment">// The accessibility focus didn't handle the event, so clear</span></span><br><span class="line">                           <span class="comment">// the flag and do a normal dispatch to all children.</span></span><br><span class="line">                           ev.setTargetAccessibilityFocus(<span class="keyword">false</span>);</span><br><span class="line">                       &#125;</span><br><span class="line">                       <span class="keyword">if</span> (preorderedList != <span class="keyword">null</span>) preorderedList.clear();</span><br><span class="line">                   &#125;</span><br><span class="line"></span><br><span class="line">                   <span class="keyword">if</span> (newTouchTarget == <span class="keyword">null</span> &amp;&amp; mFirstTouchTarget != <span class="keyword">null</span>) &#123;</span><br><span class="line">                       <span class="comment">// Did not find a child to receive the event.</span></span><br><span class="line">                       <span class="comment">// Assign the pointer to the least recently added target.</span></span><br><span class="line">                       newTouchTarget = mFirstTouchTarget;</span><br><span class="line">                       <span class="keyword">while</span> (newTouchTarget.next != <span class="keyword">null</span>) &#123;</span><br><span class="line">                           newTouchTarget = newTouchTarget.next;</span><br><span class="line">                       &#125;</span><br><span class="line">                       newTouchTarget.pointerIdBits |= idBitsToAssign;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="comment">// Dispatch to touch targets.</span></span><br><span class="line">           <span class="keyword">if</span> (mFirstTouchTarget == <span class="keyword">null</span>) &#123;</span><br><span class="line">               <span class="comment">// No touch targets so treat this as an ordinary view.</span></span><br><span class="line">               handled = dispatchTransformedTouchEvent(ev, canceled, <span class="keyword">null</span>,</span><br><span class="line">                       TouchTarget.ALL_POINTER_IDS);</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="comment">// Dispatch to touch targets, excluding the new touch target if we already</span></span><br><span class="line">               <span class="comment">// dispatched to it.  Cancel touch targets if necessary.</span></span><br><span class="line">               TouchTarget predecessor = <span class="keyword">null</span>;</span><br><span class="line">               TouchTarget target = mFirstTouchTarget;</span><br><span class="line">               <span class="keyword">while</span> (target != <span class="keyword">null</span>) &#123;</span><br><span class="line">                   <span class="keyword">final</span> TouchTarget next = target.next;</span><br><span class="line">                   <span class="keyword">if</span> (alreadyDispatchedToNewTouchTarget &amp;&amp; target == newTouchTarget) &#123;</span><br><span class="line">                       handled = <span class="keyword">true</span>;</span><br><span class="line">                   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                       <span class="keyword">final</span> <span class="keyword">boolean</span> cancelChild = resetCancelNextUpFlag(target.child)</span><br><span class="line">                               || intercepted;</span><br><span class="line">                       <span class="keyword">if</span> (dispatchTransformedTouchEvent(ev, cancelChild,</span><br><span class="line">                               target.child, target.pointerIdBits)) &#123;</span><br><span class="line">                           handled = <span class="keyword">true</span>;</span><br><span class="line">                       &#125;</span><br><span class="line">                       <span class="keyword">if</span> (cancelChild) &#123;</span><br><span class="line">                           <span class="keyword">if</span> (predecessor == <span class="keyword">null</span>) &#123;</span><br><span class="line">                               mFirstTouchTarget = next;</span><br><span class="line">                           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                               predecessor.next = next;</span><br><span class="line">                           &#125;</span><br><span class="line">                           target.recycle();</span><br><span class="line">                           target = next;</span><br><span class="line">                           <span class="keyword">continue</span>;</span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125;</span><br><span class="line">                   predecessor = target;</span><br><span class="line">                   target = next;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="comment">// Update list of touch targets for pointer up or cancel, if needed.</span></span><br><span class="line">           <span class="keyword">if</span> (canceled</span><br><span class="line">                   || actionMasked == MotionEvent.ACTION_UP</span><br><span class="line">                   || actionMasked == MotionEvent.ACTION_HOVER_MOVE) &#123;</span><br><span class="line">               resetTouchState();</span><br><span class="line">           &#125; <span class="keyword">else</span> <span class="keyword">if</span> (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_UP) &#123;</span><br><span class="line">               <span class="keyword">final</span> <span class="keyword">int</span> actionIndex = ev.getActionIndex();</span><br><span class="line">               <span class="keyword">final</span> <span class="keyword">int</span> idBitsToRemove = <span class="number">1</span> &lt;&lt; ev.getPointerId(actionIndex);</span><br><span class="line">               removePointersFromTouchTargets(idBitsToRemove);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (!handled &amp;&amp; mInputEventConsistencyVerifier != <span class="keyword">null</span>) &#123;</span><br><span class="line">           mInputEventConsistencyVerifier.onUnhandledEvent(ev, <span class="number">1</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> handled;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// ä¸‹é¢æ˜¯dispatchTransformedTouchEvent çš„æºç </span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Transforms a motion event into the coordinate space of a particular child view,</span></span><br><span class="line"><span class="comment">    * filters out irrelevant pointer ids, and overrides its action if necessary.</span></span><br><span class="line"><span class="comment">    * If child is null, assumes the MotionEvent will be sent to this ViewGroup instead.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">dispatchTransformedTouchEvent</span><span class="params">(MotionEvent event, <span class="keyword">boolean</span> cancel,</span></span></span><br><span class="line"><span class="function"><span class="params">           View child, <span class="keyword">int</span> desiredPointerIdBits)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">final</span> <span class="keyword">boolean</span> handled;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// Canceling motions is a special case.  We don't need to perform any transformations</span></span><br><span class="line">       <span class="comment">// or filtering.  The important part is the action, not the contents.</span></span><br><span class="line">       <span class="comment">// åœ¨äº‹ä»¶è¢«å–æ¶ˆä¸‹æ‰§è¡Œä¸‹é¢çš„ä»£ç </span></span><br><span class="line">       <span class="keyword">final</span> <span class="keyword">int</span> oldAction = event.getAction();</span><br><span class="line">       <span class="keyword">if</span> (cancel || oldAction == MotionEvent.ACTION_CANCEL) &#123; </span><br><span class="line">           event.setAction(MotionEvent.ACTION_CANCEL);dispatchTouchEvent æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯viewç±»</span><br><span class="line">           <span class="keyword">if</span> (child == <span class="keyword">null</span>) &#123; </span><br><span class="line">               <span class="comment">//æ²¡æœ‰å­å…ƒç´ ï¼Œè°ƒç”¨çˆ¶ç±»çš„</span></span><br><span class="line">               handled = <span class="keyword">super</span>.dispatchTouchEvent(event);</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="comment">// å­˜åœ¨å­å…ƒç´ åˆ™è°ƒç”¨å­å…ƒç´ è¿›è¡Œäº‹ä»¶ä¼ é€’è½®è¯¢ä¸Šé¢çš„æ“ä½œ</span></span><br><span class="line">               handled = child.dispatchTouchEvent(event);</span><br><span class="line">           &#125;</span><br><span class="line">           event.setAction(oldAction);</span><br><span class="line">           <span class="keyword">return</span> handled;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// Calculate the number of pointers to deliver.</span></span><br><span class="line">       <span class="keyword">final</span> <span class="keyword">int</span> oldPointerIdBits = event.getPointerIdBits();</span><br><span class="line">       <span class="keyword">final</span> <span class="keyword">int</span> newPointerIdBits = oldPointerIdBits &amp; desiredPointerIdBits;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// If for some reason we ended up in an inconsistent state where it looks like we</span></span><br><span class="line">       <span class="comment">// might produce a motion event with no pointers in it, then drop the event.</span></span><br><span class="line">       <span class="keyword">if</span> (newPointerIdBits == <span class="number">0</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// If the number of pointers is the same and we don't need to perform any fancy</span></span><br><span class="line">       <span class="comment">// irreversible transformations, then we can reuse the motion event for this</span></span><br><span class="line">       <span class="comment">// dispatch as long as we are careful to revert any changes we make.</span></span><br><span class="line">       <span class="comment">// Otherwise we need to make a copy.</span></span><br><span class="line">       <span class="keyword">final</span> MotionEvent transformedEvent;</span><br><span class="line">       <span class="keyword">if</span> (newPointerIdBits == oldPointerIdBits) &#123;</span><br><span class="line">           <span class="keyword">if</span> (child == <span class="keyword">null</span> || child.hasIdentityMatrix()) &#123;</span><br><span class="line">               <span class="keyword">if</span> (child == <span class="keyword">null</span>) &#123;</span><br><span class="line">                   handled = <span class="keyword">super</span>.dispatchTouchEvent(event);</span><br><span class="line">               &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                   <span class="keyword">final</span> <span class="keyword">float</span> offsetX = mScrollX - child.mLeft;</span><br><span class="line">                   <span class="keyword">final</span> <span class="keyword">float</span> offsetY = mScrollY - child.mTop;</span><br><span class="line">                   event.offsetLocation(offsetX, offsetY);</span><br><span class="line"></span><br><span class="line">                   handled = child.dispatchTouchEvent(event);</span><br><span class="line"></span><br><span class="line">                   event.offsetLocation(-offsetX, -offsetY);</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="keyword">return</span> handled;</span><br><span class="line">           &#125;</span><br><span class="line">           transformedEvent = MotionEvent.obtain(event);</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           transformedEvent = event.split(newPointerIdBits);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// Perform any necessary transformations and dispatch.</span></span><br><span class="line">       <span class="keyword">if</span> (child == <span class="keyword">null</span>) &#123;</span><br><span class="line">           handled = <span class="keyword">super</span>.dispatchTouchEvent(transformedEvent);</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">final</span> <span class="keyword">float</span> offsetX = mScrollX - child.mLeft;</span><br><span class="line">           <span class="keyword">final</span> <span class="keyword">float</span> offsetY = mScrollY - child.mTop;</span><br><span class="line">           transformedEvent.offsetLocation(offsetX, offsetY);</span><br><span class="line">           <span class="keyword">if</span> (! child.hasIdentityMatrix()) &#123;</span><br><span class="line">               transformedEvent.transform(child.getInverseMatrix());</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           handled = child.dispatchTouchEvent(transformedEvent);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// Done.</span></span><br><span class="line">       transformedEvent.recycle();</span><br><span class="line">       <span class="keyword">return</span> handled;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>ViewGroup çš„äº‹ä»¶ä¼ é€’è¿‡ç¨‹æ€»ç»“ä¸ºï¼Œä¸æ–­çš„æŸ¥æ‰¾å­èŠ‚ç‚¹çš„å¯ä»¥æ¶ˆè´¹æ­¤äº‹ä»¶çš„è¿‡ç¨‹ï¼Œå½“view çš„onTouchEvent çš„è¿”å›å€¼ä¸ºfalseï¼Œå½“å‰viewä¸æ¶ˆè´¹è¿™ä¸ªäº‹ä»¶ï¼Œä¸æŒæœ‰ã€‚å¦‚æœä¸ºtrueï¼Œåˆ™viewæ¶ˆè´¹è¯¥äº‹ä»¶å¹¶ä¸å†å‘å¤–ä¼ é€’äº†ã€‚è¿™ä¸ªè¿‡ç¨‹å¾ˆç±»ä¼¼è´£ä»»é“¾ï¼Œäº‹ä»¶çš„åˆ†å‘åœ¨å¯»æ‰¾è´£ä»»è€…ï¼Œåˆé€‚çš„è´£ä»»è€…æ¶ˆè´¹è¿™ä¸ªäº‹ä»¶ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¼˜ç‚¹ï¼šè¯·æ±‚è€…å’Œå¤„ç†è€…å…³ç³»è§£è€¦<br>ç¼ºç‚¹ï¼šå¯¹é“¾ä¸­è¯·æ±‚å¤„ç†éœ€è¦éå†ï¼Œå¤„ç†è€…è¿‡å¤šå½±å“æ€§èƒ½ï¼Œä½¿ç”¨é€’å½’è¦æ…é‡å§ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/12/30/è´£ä»»é“¾æ¨¡å¼å®ç°ä¸ç ”ç©¶/" data-id="ckgur4ylp004p4z3klisiqrq1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-åŸå‹æ¨¡å¼-Prototype-å®ç°ä¸ç ”ç©¶" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/30/åŸå‹æ¨¡å¼-Prototype-å®ç°ä¸ç ”ç©¶/" class="article-date">
  <time datetime="2017-12-30T13:03:03.000Z" itemprop="datePublished">2017-12-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Design-Pattern/">Design Pattern</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/30/åŸå‹æ¨¡å¼-Prototype-å®ç°ä¸ç ”ç©¶/">åŸå‹æ¨¡å¼(Prototype)å®ç°ä¸ç ”ç©¶</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>æŒ‡çš„æ˜¯åˆ›å»ºå¯¹è±¡ï¼Œå¹¶é€šè¿‡æ‹·è´åˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œåˆ†ä¸º</p>
<h2 id="åœºæ™¯æ¨¡æ‹Ÿ"><a href="#åœºæ™¯æ¨¡æ‹Ÿ" class="headerlink" title="åœºæ™¯æ¨¡æ‹Ÿ"></a>åœºæ™¯æ¨¡æ‹Ÿ</h2><p>android ä¸­çš„intentå®ç°</p>
<h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><ul>
<li>android ä¸­çš„intentå®ç°<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç³»ç»Ÿè°ƒç”¨</span></span><br><span class="line">Intent intent = <span class="keyword">new</span> Intent(MainActivity09.<span class="keyword">this</span>,MainActivity08.class);</span><br><span class="line">startActivity(intent);</span><br><span class="line"><span class="comment">// ---------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">//intent çš„ç³»ç»Ÿæºç </span></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Create an empty intent.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Intent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Copy constructor.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Intent</span><span class="params">(Intent o)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.mAction = o.mAction;</span><br><span class="line">       <span class="keyword">this</span>.mData = o.mData;</span><br><span class="line">       <span class="keyword">this</span>.mType = o.mType;</span><br><span class="line">       <span class="keyword">this</span>.mPackage = o.mPackage;</span><br><span class="line">       <span class="keyword">this</span>.mComponent = o.mComponent;</span><br><span class="line">       <span class="keyword">this</span>.mFlags = o.mFlags;</span><br><span class="line">       <span class="keyword">this</span>.mContentUserHint = o.mContentUserHint;</span><br><span class="line">       <span class="keyword">if</span> (o.mCategories != <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="keyword">this</span>.mCategories = <span class="keyword">new</span> ArraySet&lt;String&gt;(o.mCategories);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (o.mExtras != <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="keyword">this</span>.mExtras = <span class="keyword">new</span> Bundle(o.mExtras);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (o.mSourceBounds != <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="keyword">this</span>.mSourceBounds = <span class="keyword">new</span> Rect(o.mSourceBounds);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (o.mSelector != <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="keyword">this</span>.mSelector = <span class="keyword">new</span> Intent(o.mSelector);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (o.mClipData != <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="keyword">this</span>.mClipData = <span class="keyword">new</span> ClipData(o.mClipData);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Object <span class="title">clone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> Intent(<span class="keyword">this</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="title">Intent</span><span class="params">(Intent o, <span class="keyword">boolean</span> all)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.mAction = o.mAction;</span><br><span class="line">       <span class="keyword">this</span>.mData = o.mData;</span><br><span class="line">       <span class="keyword">this</span>.mType = o.mType;</span><br><span class="line">       <span class="keyword">this</span>.mPackage = o.mPackage;</span><br><span class="line">       <span class="keyword">this</span>.mComponent = o.mComponent;</span><br><span class="line">       <span class="keyword">if</span> (o.mCategories != <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="keyword">this</span>.mCategories = <span class="keyword">new</span> ArraySet&lt;String&gt;(o.mCategories);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Make a clone of only the parts of the Intent that are relevant for</span></span><br><span class="line"><span class="comment">    * filter matching: the action, data, type, component, and categories.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Intent <span class="title">cloneFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> Intent(<span class="keyword">this</span>, <span class="keyword">false</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>ä»ä¸Šé¢çš„intent çš„æºç å¯ä»¥çœ‹åˆ°ï¼Œcloneæ–¹æ³•å¹¶æ²¡æœ‰è°ƒç”¨çˆ¶ç±»çš„super.cloneæ–¹æ³•ï¼Œè€Œæ˜¯æ‰§è¡Œäº†new intent(this),è¿™ä¹ˆåšå…¶å®æ˜¯è€ƒè™‘åˆ°clone å’Œnewä¸€ä¸ªå¯¹è±¡æ‰€éœ€è¦çš„æˆæœ¬å†³å®šçš„ï¼Œå°†ä¹‹å‰çš„å¯¹è±¡è¿›è¡Œcopyï¼Œç„¶ååœ¨ç”Ÿæˆï¼Œå°±æ˜¯è¿™ä¸ªæµç¨‹ã€‚</p>
<h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><p>ä¸Šé¢è¿˜æœ‰ startActivity(intent); ä¸‹é¢å°±åˆ†æä¸‹intent çš„è·³è½¬é€»è¾‘æ˜¯æ€æ ·çš„<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Same as &#123;<span class="doctag">@link</span> #startActivity(Intent, Bundle)&#125; with no options</span></span><br><span class="line"><span class="comment">     * specified.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> intent The intent to start.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> android.content.ActivityNotFoundException</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> &#123;<span class="doctag">@link</span> #startActivity(Intent, Bundle)&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #startActivityForResult</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startActivity</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.startActivity(intent, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startActivity</span><span class="params">(Intent intent, @Nullable Bundle options)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (options != <span class="keyword">null</span>) &#123;</span><br><span class="line">            startActivityForResult(intent, -<span class="number">1</span>, options);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Note we want to go through this call for compatibility with</span></span><br><span class="line">            <span class="comment">// applications that may have overridden the method.</span></span><br><span class="line">            startActivityForResult(intent, -<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startActivityForResult</span><span class="params">(Intent intent, <span class="keyword">int</span> requestCode, @Nullable Bundle options)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mParent == <span class="keyword">null</span>) &#123;</span><br><span class="line">            Instrumentation.ActivityResult ar =</span><br><span class="line">                mInstrumentation.execStartActivity(</span><br><span class="line">                    <span class="keyword">this</span>, mMainThread.getApplicationThread(), mToken, <span class="keyword">this</span>,</span><br><span class="line">                    intent, requestCode, options);</span><br><span class="line">            <span class="keyword">if</span> (ar != <span class="keyword">null</span>) &#123;</span><br><span class="line">                mMainThread.sendActivityResult(</span><br><span class="line">                    mToken, mEmbeddedID, requestCode, ar.getResultCode(),</span><br><span class="line">                    ar.getResultData());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (requestCode &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// If this start is requesting a result, we can avoid making</span></span><br><span class="line">                <span class="comment">// the activity visible until the result is received.  Setting</span></span><br><span class="line">                <span class="comment">// this code during onCreate(Bundle savedInstanceState) or onResume() will keep the</span></span><br><span class="line">                <span class="comment">// activity hidden during this time, to avoid flickering.</span></span><br><span class="line">                <span class="comment">// This can only be done when a result is requested because</span></span><br><span class="line">                <span class="comment">// that guarantees we will get information back when the</span></span><br><span class="line">                <span class="comment">// activity is finished, no matter what happens to it.</span></span><br><span class="line">                mStartedActivity = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            cancelInputsAndStartExitTransition(options);</span><br><span class="line">            <span class="comment">// TODO Consider clearing/flushing other event sources and events for child windows.</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (options != <span class="keyword">null</span>) &#123;</span><br><span class="line">                mParent.startActivityFromChild(<span class="keyword">this</span>, intent, requestCode, options);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// Note we want to go through this method for compatibility with</span></span><br><span class="line">                <span class="comment">// existing applications that may have overridden it.</span></span><br><span class="line">                mParent.startActivityFromChild(<span class="keyword">this</span>, intent, requestCode);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ActivityResult <span class="title">execStartActivity</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            Context who, IBinder contextThread, IBinder token, Activity target,</span></span></span><br><span class="line"><span class="function"><span class="params">            Intent intent, <span class="keyword">int</span> requestCode, Bundle options)</span> </span>&#123;</span><br><span class="line">        IApplicationThread whoThread = (IApplicationThread) contextThread;</span><br><span class="line">        Uri referrer = target != <span class="keyword">null</span> ? target.onProvideReferrer() : <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (referrer != <span class="keyword">null</span>) &#123;</span><br><span class="line">            intent.putExtra(Intent.EXTRA_REFERRER, referrer);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mActivityMonitors != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (mSync) &#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> N = mActivityMonitors.size();</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; i++) &#123;</span><br><span class="line">                    <span class="keyword">final</span> ActivityMonitor am = mActivityMonitors.get(i);</span><br><span class="line">                    <span class="keyword">if</span> (am.match(who, <span class="keyword">null</span>, intent)) &#123;</span><br><span class="line">                        am.mHits++;</span><br><span class="line">                        <span class="keyword">if</span> (am.isBlocking()) &#123;</span><br><span class="line">                            <span class="keyword">return</span> requestCode &gt;= <span class="number">0</span> ? am.getResult() : <span class="keyword">null</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            intent.migrateExtraStreamToClipData();</span><br><span class="line">            intent.prepareToLeaveProcess();</span><br><span class="line"><span class="comment">//ActivityManagerNative ä¸ºä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå…·ä½“çš„å®ç°åœ¨ActivityManagerService</span></span><br><span class="line">            <span class="keyword">int</span> result = ActivityManagerNative.getDefault()</span><br><span class="line">                .startActivity(whoThread, who.getBasePackageName(), intent,</span><br><span class="line">                        intent.resolveTypeIfNeeded(who.getContentResolver()),</span><br><span class="line">                        token, target != <span class="keyword">null</span> ? target.mEmbeddedID : <span class="keyword">null</span>,</span><br><span class="line">                        requestCode, <span class="number">0</span>, <span class="keyword">null</span>, options);</span><br><span class="line">            checkStartActivityResult(result, intent);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Failure from system"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ActivityManagerService ä¸­è°ƒç”¨äº†startActivityAsUserï¼Œç»§ç»­è°ƒç”¨äº†mStackSupervisor.startActivityMayWait</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">startActivity</span><span class="params">(IApplicationThread caller, String callingPackage,</span></span></span><br><span class="line"><span class="function"><span class="params">            Intent intent, String resolvedType, IBinder resultTo, String resultWho, <span class="keyword">int</span> requestCode,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">int</span> startFlags, ProfilerInfo profilerInfo, Bundle options)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> startActivityAsUser(caller, callingPackage, intent, resolvedType, resultTo,</span><br><span class="line">            resultWho, requestCode, startFlags, profilerInfo, options,</span><br><span class="line">            UserHandle.getCallingUserId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">startActivityAsUser</span><span class="params">(IApplicationThread caller, String callingPackage,</span></span></span><br><span class="line"><span class="function"><span class="params">            Intent intent, String resolvedType, IBinder resultTo, String resultWho, <span class="keyword">int</span> requestCode,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">int</span> startFlags, ProfilerInfo profilerInfo, Bundle options, <span class="keyword">int</span> userId)</span> </span>&#123;</span><br><span class="line">        enforceNotIsolatedCaller(<span class="string">"startActivity"</span>);</span><br><span class="line">        userId = handleIncomingUser(Binder.getCallingPid(), Binder.getCallingUid(), userId,</span><br><span class="line">                <span class="keyword">false</span>, ALLOW_FULL_ONLY, <span class="string">"startActivity"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Switch to user app stacks here.</span></span><br><span class="line">        <span class="keyword">return</span> mStackSupervisor.startActivityMayWait(caller, -<span class="number">1</span>, callingPackage, intent,</span><br><span class="line">                resolvedType, <span class="keyword">null</span>, <span class="keyword">null</span>, resultTo, resultWho, requestCode, startFlags,</span><br><span class="line">                profilerInfo, <span class="keyword">null</span>, <span class="keyword">null</span>, options, <span class="keyword">false</span>, userId, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ActivityStackSuper çš„startActivityMayWait éƒ¨åˆ†æ–¹æ³•ï¼Œæœ€ç»ˆè°ƒç”¨äº†pms çš„resolveIntent æ–¹æ³•</span></span><br><span class="line"> <span class="keyword">try</span> &#123;</span><br><span class="line">                            ResolveInfo rInfo =</span><br><span class="line">                                AppGlobals.getPackageManager().resolveIntent(</span><br><span class="line">                                        intent, <span class="keyword">null</span>,</span><br><span class="line">                                        PackageManager.MATCH_DEFAULT_ONLY</span><br><span class="line">                                        | ActivityManagerService.STOCK_PM_FLAGS, userId);</span><br><span class="line">                            aInfo = rInfo != <span class="keyword">null</span> ? rInfo.activityInfo : <span class="keyword">null</span>;</span><br><span class="line">                            aInfo = mService.getActivityInfoForUser(aInfo, userId);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">                            aInfo = <span class="keyword">null</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//queryIntentActivitityes  ä¸»è¦è°ƒç”¨äº†pms de resolveIntentæ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ResolveInfo&gt; <span class="title">queryIntentActivityOptions</span><span class="params">(ComponentName caller,</span></span></span><br><span class="line"><span class="function"><span class="params">            Intent[] specifics, String[] specificTypes, Intent intent,</span></span></span><br><span class="line"><span class="function"><span class="params">            String resolvedType, <span class="keyword">int</span> flags, <span class="keyword">int</span> userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!sUserManager.exists(userId)) <span class="keyword">return</span> Collections.emptyList();</span><br><span class="line">        enforceCrossUserPermission(Binder.getCallingUid(), userId, <span class="keyword">false</span>,</span><br><span class="line">                <span class="keyword">false</span>, <span class="string">"query intent activity options"</span>);</span><br><span class="line">        <span class="keyword">final</span> String resultsAction = intent.getAction();</span><br><span class="line"></span><br><span class="line">        List&lt;ResolveInfo&gt; results = queryIntentActivities(intent, resolvedType, flags</span><br><span class="line">                | PackageManager.GET_RESOLVED_FILTER, userId);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (DEBUG_INTENT_MATCHING) &#123;</span><br><span class="line">            Log.v(TAG, <span class="string">"Query "</span> + intent + <span class="string">": "</span> + results);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> specificsPos = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> N;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// todo: note that the algorithm used here is O(N^2).  This</span></span><br><span class="line">        <span class="comment">// isn't a problem in our current environment, but if we start running</span></span><br><span class="line">        <span class="comment">// into situations where we have more than 5 or 10 matches then this</span></span><br><span class="line">        <span class="comment">// should probably be changed to something smarter...</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// First we go through and resolve each of the specific items</span></span><br><span class="line">        <span class="comment">// that were supplied, taking care of removing any corresponding</span></span><br><span class="line">        <span class="comment">// duplicate items in the generic resolve list.</span></span><br><span class="line">        <span class="keyword">if</span> (specifics != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;specifics.length; i++) &#123;</span><br><span class="line">                <span class="keyword">final</span> Intent sintent = specifics[i];</span><br><span class="line">                <span class="keyword">if</span> (sintent == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (DEBUG_INTENT_MATCHING) &#123;</span><br><span class="line">                    Log.v(TAG, <span class="string">"Specific #"</span> + i + <span class="string">": "</span> + sintent);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                String action = sintent.getAction();</span><br><span class="line">                <span class="keyword">if</span> (resultsAction != <span class="keyword">null</span> &amp;&amp; resultsAction.equals(action)) &#123;</span><br><span class="line">                    <span class="comment">// If this action was explicitly requested, then don't</span></span><br><span class="line">                    <span class="comment">// remove things that have it.</span></span><br><span class="line">                    action = <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                ResolveInfo ri = <span class="keyword">null</span>;</span><br><span class="line">                ActivityInfo ai = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">                ComponentName comp = sintent.getComponent();</span><br><span class="line">                <span class="keyword">if</span> (comp == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="comment">//è¿™é‡Œæœ€å…³é”®</span></span><br><span class="line">                    ri = resolveIntent(</span><br><span class="line">                        sintent,</span><br><span class="line">                        specificTypes != <span class="keyword">null</span> ? specificTypes[i] : <span class="keyword">null</span>,</span><br><span class="line">                            flags, userId);</span><br><span class="line">                    <span class="keyword">if</span> (ri == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (ri == mResolveInfo) &#123;</span><br><span class="line">                        <span class="comment">// ACK!  Must do something better with this.</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    ai = ri.activityInfo;</span><br><span class="line">                    comp = <span class="keyword">new</span> ComponentName(ai.applicationInfo.packageName,</span><br><span class="line">                            ai.name);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    ai = getActivityInfo(comp, flags, userId);</span><br><span class="line">                    <span class="keyword">if</span> (ai == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line"> ï¼ï¼queryIntentAactivity  è¿”å›äº†ä¸€ä¸ªacitivtyinfoçš„å¯¹è±¡åˆ—è¡¨</span><br><span class="line"> ResolveInfo xpResolveInfo  = querySkipCurrentProfileIntents(matchingFilters, intent,</span><br><span class="line">                        resolvedType, flags, userId);</span><br><span class="line">                <span class="keyword">if</span> (xpResolveInfo != <span class="keyword">null</span> &amp;&amp; isUserEnabled(xpResolveInfo.targetUserId)) &#123;</span><br><span class="line">                    List&lt;ResolveInfo&gt; result = <span class="keyword">new</span> ArrayList&lt;ResolveInfo&gt;(<span class="number">1</span>);</span><br><span class="line">                    result.add(xpResolveInfo);</span><br><span class="line">                    <span class="keyword">return</span> filterIfNotPrimaryUser(result, userId);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Check for results in the current profile.</span></span><br><span class="line">                List&lt;ResolveInfo&gt; result = mActivities.queryIntent(</span><br><span class="line">                        intent, resolvedType, flags, userId);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Check for cross profile results.</span></span><br><span class="line">                xpResolveInfo = queryCrossProfileIntents(</span><br><span class="line">                        matchingFilters, intent, resolvedType, flags, userId);</span><br><span class="line"></span><br><span class="line">è¿™ä¸ªåˆ—è¡¨å…¶å®ä¹Ÿå°±æ˜¯ç¨‹åºå…¥å£çš„æ—¶å€™é€šè¿‡manifest æ–‡ä»¶è¿›è¡Œåå°„åçš„acitivitiy é›†åˆ</span><br><span class="line"></span><br><span class="line"> <span class="comment">// All available activities, for your resolving pleasure.</span></span><br><span class="line">    <span class="keyword">final</span> ActivityIntentResolver mActivities =</span><br><span class="line">            <span class="keyword">new</span> ActivityIntentResolver();</span><br></pre></td></tr></table></figure></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç³»ç»Ÿå¯åŠ¨packagemanagerservice ä¼šè§£æè·å–åˆ°æ‰€æœ‰å®‰è£…çš„åº”ç”¨çš„ä¿¡æ¯ï¼Œæ„å»ºä¸€ä¸ªä¿¡æ¯è¡¨ï¼Œç”¨æˆ·é€šè¿‡intent è·³è½¬ï¼Œä¼šæ ¹æ®intent ä¸­åŒ…å«çš„ä¿¡æ¯åˆ°è¿™ä¸ªåˆ—è¡¨ä¸­è¿›è¡ŒåŒ¹é…æŸ¥æ‰¾ï¼Œæ²¡æœ‰æŒ‡å®šå…·ä½“çš„æŸ¥è¯¢æ¡ä»¶çš„ï¼ŒæŒ‰ç…§æ¨¡ç³ŠæŸ¥è¯¢è¿›è¡Œæœ€åè¿”å›ä¸€ä¸ªåŒ¹é…åˆ—è¡¨ã€‚ç„¶åè¿›è¡Œè·³è½¬ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/12/30/åŸå‹æ¨¡å¼-Prototype-å®ç°ä¸ç ”ç©¶/" data-id="ckgur4yl0003a4z3k2sl89lub" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Config/">Config</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CustomView/">CustomView</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Data-Structure/">Data Structure</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Design-Pattern/">Design Pattern</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/media/">media</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Activity/">Activity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Activity-View/">Activity View</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Glide/">Glide</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ImageView/">ImageView</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jni/">Jni</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ndk/">Ndk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ProGuard/">ProGuard</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Retrofit/">Retrofit</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ScaleType/">ScaleType</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/clock/">clock</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jenkins/">jenkins</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/media/">media</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/permission/">permission</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/viewgroup/">viewgroup</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Activity/" style="font-size: 13.33px;">Activity</a> <a href="/tags/Activity-View/" style="font-size: 10px;">Activity View</a> <a href="/tags/Glide/" style="font-size: 10px;">Glide</a> <a href="/tags/ImageView/" style="font-size: 10px;">ImageView</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/Jni/" style="font-size: 10px;">Jni</a> <a href="/tags/Ndk/" style="font-size: 10px;">Ndk</a> <a href="/tags/ProGuard/" style="font-size: 10px;">ProGuard</a> <a href="/tags/Retrofit/" style="font-size: 16.67px;">Retrofit</a> <a href="/tags/ScaleType/" style="font-size: 10px;">ScaleType</a> <a href="/tags/clock/" style="font-size: 13.33px;">clock</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/jenkins/" style="font-size: 13.33px;">jenkins</a> <a href="/tags/maven/" style="font-size: 10px;">maven</a> <a href="/tags/media/" style="font-size: 13.33px;">media</a> <a href="/tags/permission/" style="font-size: 10px;">permission</a> <a href="/tags/viewgroup/" style="font-size: 10px;">viewgroup</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/10/29/Activityå¦‚ä½•è®¡ç®—viewçš„å±‚çº§æ·±åº¦/">Activityå¦‚ä½•è®¡ç®—viewçš„å±‚çº§æ·±åº¦</a>
          </li>
        
          <li>
            <a href="/2020/10/28/æœç´¢é¡¹ç›®apkæ–‡ä»¶/">æœç´¢é¡¹ç›®apkæ–‡ä»¶</a>
          </li>
        
          <li>
            <a href="/2018/01/14/Ijkplayer-androidç«¯æ‰§è¡Œæµç¨‹åˆ†æ/">Ijkplayer androidç«¯æ‰§è¡Œæµç¨‹åˆ†æ</a>
          </li>
        
          <li>
            <a href="/2018/01/14/android-æ’­æ”¾å™¨è°ƒç ”åˆ†æ/">android æ’­æ”¾å™¨è°ƒç ”åˆ†æ</a>
          </li>
        
          <li>
            <a href="/2017/12/30/è‡ªå®šä¹‰viewï¼æ ‡ç­¾/">è‡ªå®šä¹‰viewï¼æ ‡ç­¾</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 bei1999<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>